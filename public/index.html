<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Somali Eye Health Alliance (SEHA) | Eye Care & Blindness Prevention in Somalia</title>
  <meta name="google-site-verification" content="e2WLM9R1e8ZZ5qZ0Pv18RkWHXEu5HffnHc_OdZG74TM" />
<meta
  name="description"
  content="Somali Eye Health Alliance (SEHA) is a local NGO providing eye care services, blindness prevention, community outreach, and vision health programs across Somalia."
/>
<link rel="canonical" href="https://www.somalieyehealthalliance.org/" />
  <link rel="icon" href="images/logo.png">
   <link rel="stylesheet" href="style.css">

    
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const current = window.location.pathname.split("/").pop(); 
      document.querySelectorAll(".main-nav a").forEach(a => {
        const href = a.getAttribute("href");
        if (href === current) {
          a.classList.add("active");
        }
      });
    });
    </script>
    


<style>
  /* small tweak so the animated numbers and suffix align nicely */
  .stat-number { display:flex; align-items:baseline; gap:6px; justify-content:center; }
  .stat-number .count { display:inline-block; min-width:3ch; text-align:center; }
  .stat-number .suffix { font-weight:700; opacity:0.95; font-size:0.7em; margin-left:2px; color:inherit; }
  
  /* optional: a subtle entrance animation for the stat card when it appears */
  .stat[data-animated="true"] { transform: translateY(0); opacity:1; transition: transform .42s cubic-bezier(.2,.9,.2,1), opacity .38s ease; }
  .stat { transform: translateY(6px); opacity:0; }

  /* --- Impact stats: single-row on desktop, big numbers --- */
.stats-row {
  display:flex;
  gap:28px;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;            /* allow wrapping on small screens */
  margin: 0;
}

/* Each stat behaves like a responsive column */
.stat {
  flex: 1 1 0;
  min-width: 0;              /* prevents overflow when text is long */
  text-align: center;
  padding: 8px 6px;
}

/* Make number big and responsive; clamp prevents it from growing too much */
.stat-number .count {
  font-weight: 900;
  font-size: clamp(28px, 5.6vw, 54px); /* small:28, fluid, max:64 */
  line-height: 1;
  letter-spacing: -0.02em;
  display: inline-block;
  min-width: 3ch;
}

/* keep suffix visually smaller but bold */
.stat-number .suffix {
  font-weight: 800;
  opacity: 0.95;
  font-size: 0.6em;
  margin-left: 6px;
  display: inline-block;
  vertical-align: baseline;
}

/* entrance animation (optional) */
.stat[data-animated="true"] { transform: translateY(0); opacity:1; transition: transform .42s cubic-bezier(.2,.9,.2,1), opacity .38s ease; }
.stat { transform: translateY(6px); opacity:0; }


/* make the number colorable and smooth */
.stat-number .count,
.stat-number .suffix {
  transition: color .18s ease;
}

/* Example theme colors */
.stat-number.teal .count,
.stat-number.teal .suffix { color: #0f766e; }   /* green/teal */
.stat-number.blue .count,
.stat-number.blue .suffix { color: #2563eb; }   /* blue */
.stat-number.orange .count,
.stat-number.orange .suffix { color: #f97316; } /* orange */

/* If you want the suffix slightly dimmer */
.stat-number .suffix { opacity: 0.92; font-weight: 800; }

/* Desktop: force single row (no wrap) and a bit more spacing */
@media (min-width: 981px) {
  .stats-row { flex-wrap: nowrap; gap:36px; }
  .stat { padding: 12px 14px; }
}

/* Mobile: stack vertically */
@media (max-width: 980px) {
  .stats-row { flex-direction: column; gap: 10px; }
  .stat-number .count { font-size: clamp(22px, 5.8vw, 42px); }
  .stat { text-align: left; }
}
/* --- Mobile menu styles --- */
.mobile-menu {
  display: none;
  position: fixed;
  left: 0;
  right: 0;
  top: var(--header-height, 64px);
  background: #fff;
  z-index: 150;
  box-shadow: 0 18px 80px rgba(2,6,23,0.12);
  max-height: calc(100vh - var(--header-height, 64px));
  overflow: auto;
  padding: 12px;
  transition: transform .18s ease, opacity .18s ease;
}

/* show */

/* make nav-list vertical inside mobile menu */
.mobile-menu .nav-list {
  display:flex;
  flex-direction: column;
  gap: 6px;
  margin: 0;
  padding: 0;
}

/* mobile submenu hidden by default */
.mobile-menu .sub,
.mobile-menu .mobile-sub {
  display: none;
  padding-left: 12px;
  margin-top: 6px;
}

/* when parent has 'open' show it */
.mobile-menu .nav-item.open > .sub,
.mobile-menu .nav-item.open > .mobile-sub {
  display: block;
}

/* accessible focus states inside mobile menu */
.mobile-menu a:focus { outline: 3px solid rgba(45,212,191,0.14); outline-offset: 4px; border-radius: 6px; }

/* small tweak so desktop hover popovers behave unchanged */
@media (min-width: 981px) {
  .mobile-menu { display: none !important; }
}

  </style>
  

  <!-- END: Back-to-top styles -->
</head>
<body>
<!-- HEADER -->
<header class="site-header" role="banner">
  
  <!-- small, safe header-local CSS to avoid duplicate arrows & show mobile toggle only on small screens -->
  <style>
 /* Loader overlay */
.page-loader {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: white; /* adjust to site background if needed */
  z-index: 99999;
  transition: opacity .18s ease, visibility .18s ease;
  opacity: 1;
  visibility: visible;
  pointer-events: all;
}

/* accessible label hidden visually */
.visually-hidden { position: absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0; }

/* Eye sizing & color (brand-friendly) */
.loader-eye { color: #0f766e; width: 120px; height: 80px; display:block; }

/* Pupil wrap (moves left-right) */
.pupil-wrap { transform-origin: 60px 40px; }

/* Lids that cover eye for blink; we animate scaleY to simulate blink */
.lid { transform-origin: 60px 40px; }

/* Keyframes: look left -> center -> right -> center */
@keyframes lookSides {
  0%   { transform: translateX(-8px); }
  25%  { transform: translateX(0px); }
  50%  { transform: translateX(8px); }
  75%  { transform: translateX(0px); }
  100% { transform: translateX(-8px); }
}

/* quick blink: closed at 45-50% of the blink cycle */
@keyframes blink {
  0%, 88% { transform: scaleY(0); }  /* lids open (scale 0 = out of view) */
  92%     { transform: scaleY(1.05); }/* closed */
  100%    { transform: scaleY(0); }   /* open */
}

/* Pupil subtle scale on blink for natural feel */
@keyframes pupilPulse {
  0%, 88% { transform: scale(1); }
  92%     { transform: scale(0.7); }
  100%    { transform: scale(1); }
}

/* Apply animations: fairly quick loop */
.page-loader.running .pupil-wrap {
  animation: lookSides 1.2s ease-in-out infinite;
}
.page-loader.running .lid-top,
.page-loader.running .lid-bottom {
  animation: blink 2.2s steps(1, end) infinite;
}
.page-loader.running .pupil {
  animation: pupilPulse 2.2s ease-in-out infinite;
}

/* Hide loader quickly when done */
.page-loader.loaded { opacity: 0; visibility: hidden; pointer-events: none; }

/* Prevent body scroll while loader visible */
body[data-loading="true"] { overflow: hidden !important; }

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  .page-loader.running .pupil-wrap,
  .page-loader.running .lid-top,
  .page-loader.running .lid-bottom,
  .page-loader.running .pupil { animation: none; }
}

/* optional dark mode tweak */
@media (prefers-color-scheme: dark) {
  .page-loader { background: #07102a; }
  .loader-eye { color: #2dd4bf; }
}

  </style>

  <div class="container header-inner">
    <div class="brand">
      <img src="images/logo.png" alt="SEHA logo" class="logo" />
      <div class="brand-text">
        <h1 class="org-name">Somali Eye Health Alliance</h1>
        <p class="tagline">Saving sight â€¢ Building local capacity</p>
      </div>
    </div>

    <nav class="main-nav" role="navigation" aria-label="Main Navigation">
      <ul class="nav-list">
        <li class="nav-item"><a href="index.html">Home</a></li>

        <li class="nav-item has-sub" id="nav-about">
          <a href="about.html" aria-haspopup="true" aria-expanded="false">About Us â–¾</a>

          <!-- desktop popover -->
          <div class="nav-subtitle" role="dialog" aria-hidden="true" aria-labelledby="about-subtitle">
            <ul class="subtitle-list">
              <li><a href="about.html#who" class="subtitle-link">Who we are</a></li>
              <li><a href="about.html#what-we-do" class="subtitle-link">What we do</a></li>
              <li><a href="about.html#framework" class="subtitle-link">Operational framework</a></li>
              <li><a href="about.html#team" class="subtitle-link">Our team & governance</a></li>
            </ul>
          </div>

          <!-- mobile submenu (kept for hamburger) -->
          <ul class="sub" aria-label="About submenu">
            <li><a href="about.html#who">Who we are</a></li>
            <li><a href="about.html#what-we-do">What we do</a></li>
            <li><a href="about.html#framework">Operational framework</a></li>
            <li><a href="about.html#team">Our team & governance</a></li>
          </ul>
        </li>

        <li class="nav-item has-sub" id="nav-ourwork">
          <a href="our-work.html" aria-haspopup="true" aria-expanded="false">Our Work â–¾</a>

          <div class="nav-subtitle" role="dialog" aria-hidden="true" aria-labelledby="ourwork-subtitle">
            <ul class="subtitle-list">
              <li><a href="programs.html" class="subtitle-link">Core programs</a></li>
              <li><a href="our-work.html#consortia" class="subtitle-link">Clinical consortia</a></li>
              <li><a href="our-work.html#regions" class="subtitle-link">Regional activity</a></li>
              <li><a href="our-work.html#impact" class="subtitle-link">Impact & results</a></li>
            </ul>
          </div>

          <ul class="sub" aria-label="Our Work submenu">
            <li><a href="programs.html">Programs</a></li>
            <li><a href="our-work.html#consortia">Consortia</a></li>
            <li><a href="our-work.html#regions">Regions</a></li>
          </ul>
        </li>

        <li class="nav-item"><a href="programs.html">Programs</a></li>
        <li class="nav-item"><a href="membership.html">Membership</a></li>
        <li class="nav-item"><a href="partnership.html">Partnership</a></li>

        <li class="nav-item"><a href="resources.html">Resources</a></li>
        <li class="nav-item"><a href="events.html">Events & Blogs</a></li>
        <!-- <li class="nav-item"><a href="opportunities.html">Opportunities</a></li> -->
        <li class="nav-item"><a href="awareness.html">Awareness</a></li>
        <li class="nav-item"><a href="contact.html">Contact</a></li>

        <!-- SETTINGS (single desktop link + mobile-only toggle + mobile submenu)
             - Desktop: user sees the "Settings" anchor and the .nav-subtitle popover on hover/focus
             - Mobile: the .mobile-only toggle (plus symbol) is shown and toggles the submenu;
               the mobile-only element is hidden on desktop so you do not get two visible "Settings" -->
        <li class="nav-item has-sub" id="nav-settings">
          <!-- Desktop link (visible on all widths) -->
          <!-- <a href="settings.html" aria-haspopup="true" aria-expanded="false" id="settingsDesktopLink">Settings â–¾</a> -->
          <a href="settings.html" aria-haspopup="true" aria-expanded="false">Settings â–¾</a>


          <!-- desktop popover -->
          <div class="nav-subtitle" role="dialog" aria-hidden="true" aria-labelledby="settings-subtitle">
            <ul class="subtitle-list">
              <li><a href="settings.html#account">Account settings</a></li>
              <li><a href="settings.html#privacy">Privacy & security</a></li>
              <li><a href="settings.html#appearance">Appearance</a></li>
            </ul>
          </div>

          <!-- Mobile-only toggle: hidden on desktop by .mobile-only rule above
          <a href="#" class="mobile-toggle mobile-only" data-target="settingsSub" aria-controls="settingsSub" aria-expanded="false" id="settingsMobileToggle" style="justify-content:space-between;width:100%;padding:6px 0;">
            <span>Settings</span>
            <span class="toggle-symbol" aria-hidden="true">+</span>
          </a> -->

          <!-- mobile submenu -->
          <ul class="sub mobile-sub" id="settingsSub" aria-hidden="true">
            <li><a href="settings.html#account">Account settings</a></li>
            <li><a href="settings.html#privacy">Privacy & security</a></li>
            <li><a href="settings.html#appearance">Appearance</a></li>
          </ul>
        </li>
        <!-- /SETTINGS -->

      </ul>
    </nav>

    <div class="header-cta">
      <a class="btn donate" id="donateBtn" href="donate.html" title="Donate">Donate</a>
      <button class="hamb" id="hambBtn" aria-expanded="false" aria-controls="mobileMenu" aria-label="Open menu">â˜°</button>
    </div>
  </div>

  <div class="mobile-menu" id="mobileMenu" aria-hidden="true"></div>
</header>


  <!-- MAIN -->
  <main id="main" role="main">
 <!-- HERO -->
<section id="home" class="hero" aria-label="Hero">
  <div class="hero-slides" id="heroSlides" aria-hidden="false"></div>

  <div class="hero-inner container">
    <div class="hero-intro" aria-labelledby="heroTitle">
      <h2 id="heroTitle">Protecting & restoring sight across Somalia</h2>
      <div id="heroDescription" class="lead">
        Somali Eye Health Alliance supports local clinics, trains eye-care teams, and runs community screening and surgical outreach so Somalis can keep their sight close to home.
      </div>
      <div class="hero-actions">
        <a class="btn btn-primary" href="programs.html">Our Programs</a>
        <a class="btn btn-outline" href="donate.html">Donate</a>
      </div>
    </div>

    <div class="hero-side">
      <div class="hero-gallery" id="heroGallery" aria-hidden="false" role="list"></div>

      <div id="heroCaptionBox" class="hero-caption card" aria-live="polite">
        <h4 id="heroCaptionTitle">Protecting & restoring sight across Somalia</h4>
        <p id="heroCaptionText"> Somali Eye Health Alliance supports local clinics, trains eye-care teams, and runs community outreach that brings services closer to people.</p>
        <p id="heroCaptionExtra" class="muted">Read more about this program and how it benefits communities in every region.</p>
        <p style="margin-top:8px"><a href="our-work.html">Learn more â†’</a></p>
      </div>
    </div>
  </div>
</section>

    <!-- MISSION & GOALS (separate section; NOT overlaid on hero) -->
<section id="mission" class="section bg-light">
  <div class="container two-col">
    <div class="card">
      <h3 class="section-heading">
        <img class="section-icon" src="images/mission.jpg" alt="Mission icon" />
        <span>Mission</span>
      </h3>
      <p class="muted">Strengthen local eye-care systems across Somalia through capacity building, coordinated outreach, and knowledge sharing so people receive safe, accessible eye services close to home.</p>
    </div>

    <div class="card">
      <h3 class="section-heading">
        <img class="section-icon" src="images/goals.png" alt="Goals icon" />
        <span>Goals</span>
      </h3>
      <ul class="small-list muted">
        <li>Increase screening and treatment coverage across regions</li>
        <li>Grow a sustainable local eye health workforce</li>
        <li>Support clinics with practical financing and operational tools</li>
      </ul>
    </div>
  </div>
</section>

 <!-- IMPACT -->
<section id="impact" class="section" aria-labelledby="impactHeading">
  <div class="container">
    <h3 id="impactHeading" class="section-heading">
      <img class="section-icon" src="images/impact.png" alt="Impact icon" />
      <span>Our Impact (Selected)</span>
    </h3>
    <p class="muted"> Somali Eye Health Alliance measures impact by people reached, surgeries supported and local capacity built.</p>

    <div class="stats-row" style="margin-top:12px;">
      <div class="stat">
        <div class="stat-number teal"><span class="count" data-target="12400" data-suffix="+">0</span><span class="suffix">+</span></div>
        <div class="muted">people screened (since 2022)</div>
      </div>
    
      <div class="stat">
        <div class="stat-number blue"><span class="count" data-target="4300" data-suffix="+">0</span><span class="suffix">+</span></div>
        <div class="muted">sight-restoring surgeries supported</div>
      </div>
    
      <div class="stat">
        <div class="stat-number orange"><span class="count" data-target="86" data-suffix="">0</span><span class="suffix"></span></div>
        <div class="muted">local clinics & partners</div>
      </div>
    </div>
    

    <div class="card" style="margin-top:18px;">
      <h4 class="section-heading">
        <img class="section-icon" src="images/recent.png" alt="Recent highlight icon" />
        <span>Recent highlight</span>
      </h4>

      <div class="recent-highlight">
        <div>
          <p class="muted">In 2025  Somali Eye Health Alliance supported a 4-week outreach in Beledweyne and Afgooye that screened 2,300 people and fitted 780 spectacles. Local teams were mentored in triage and low-vision follow-up.</p>
        </div>
      </div>
    </div>
  </div>
</section>
 <!-- PROGRAMS PREVIEW -->
<section id="programs-preview" class="section bg-light" aria-labelledby="programsHeading">
  <div class="container">
    <h3 id="programsHeading" class="section-heading">
      <img class="section-icon" src="images/core.png" alt="Core programs icon" />
      <span>Core programs</span>
    </h3>
    <p class="muted"> Somali Eye Health Alliance coordinates programs designed for Somalia's context: low-resource clinics, mobile outreach, research, and workforce development.</p>

    <div class="grid grid-3" id="programGrid" aria-live="polite" style="margin-top:16px;">
      <!-- sample program cards: script.js will still populate these if used -->
      <div class="program-card card">
        <div class="card-heading">
          <img class="icon" src="images/core.png" alt="Program icon">
          <div><strong>Screening & Spectacles</strong><div class="muted">Community & school screening</div></div>
        </div>
      </div>

      <div class="program-card card">
        <div class="card-heading">
          <img class="icon" src="images/core.png" alt="Program icon">
          <div><strong>Surgical Camps</strong><div class="muted">Cataract & mentorship</div></div>
        </div>
      </div>

      <div class="program-card card">
        <div class="card-heading">
          <img class="icon" src="images/core.png" alt="Program icon">
          <div><strong>Workforce Training</strong><div class="muted">CPD & local trainers</div></div>
        </div>
      </div>
    </div>

    <p style="margin-top:14px"><a href="programs.html">See all programs â†’</a></p>
  </div>
</section>

  <!-- EXPLORE: summary links to all main pages -->
<section id="explore" class="section">
  <div class="container">
    <h3 class="section-heading">
      <img class="section-icon" src="images/explore.png" alt="Explore icon" />
      <span>Explore  Somali Eye Health Alliance</span>
    </h3>
    <p class="muted">Quick summaries and links to key pages across the site.</p>
        <div class="grid grid-3" style="margin-top:14px;">
          <div class="card">
            <h4>About Us</h4>
            <p class="muted">Who we are, our principles and the team behind  Somali Eye Health Alliance. Learn how we coordinate clinics and partners across Somalia.</p>
            <p><a href="about.html">About â†’</a></p>
          </div>

          <div class="card">
            <h4>Our Work</h4>
            <p class="muted">Programs, consortia and regional approaches we use to deliver sustainable eye health services.</p>
            <p><a href="our-work.html">Our Work â†’</a></p>
          </div>

          <div class="card">
            <h4>Membership</h4>
            <p class="muted">Join our network as a clinic, volunteer or organisational partner to receive support and opportunities.</p>
            <p><a href="membership.html">Membership â†’</a></p>
          </div>

          <div class="card">
            <h4>Resources</h4>
            <p class="muted">Guides, toolkits and photos from outreach and campaigns â€” open resource library for partners.</p>
            <p><a href="resources.html">Resources â†’</a></p>
          </div>

          <div class="card">
            <h4>Events & Blogs</h4>
            <p class="muted">Workshops, launches and field reports â€” view posts, register for trainings, and join discussions.</p>
            <p><a href="events.html">Events & Blogs â†’</a></p>
          </div>

          <div class="card">
            <h4>Opportunities</h4>
            <p class="muted">Volunteer placements, short contracts and research roles. See live openings and apply online.</p>
            <p><a href="opportunities.html">Opportunities â†’</a></p>
          </div>

          <div class="card">
            <h4>Awareness</h4>
            <p class="muted">Campaign toolkits, posters and community messaging to promote eye health and prevention.</p>
            <p><a href="awareness.html">Awareness â†’</a></p>
          </div>

          <div class="card">
            <h4>Contact</h4>
            <p class="muted">Questions or partnership enquiries? Get in touch with our team.</p>
            <p><a href="contact.html">Contact â†’</a></p>
          </div>
        </div>
      </div>
    </section>

<!-- MEDIA PREVIEW -->
<section id="resources-preview" class="section bg-light" aria-labelledby="resourcesHeading">
  <div class="container">
    <h3 id="resourcesHeading" class="section-heading">
      <img class="section-icon" src="images/resources.png" alt="Resources icon" />
      <span>Resources & media</span>
    </h3>
    <p class="muted">Photos, guides and reports from field activities â€” click thumbnails to enlarge and download toolkits.</p>
        <div class="gallery-grid" id="resourceGallery" aria-live="polite" style="margin-top:12px;"></div>
        <p style="margin-top:14px"><a href="resources.html">Open resource library â†’</a></p>
      </div>
    </section>

   <!-- EVENTS PREVIEW -->
<section id="events-preview" class="section" aria-labelledby="eventsHeading">
  <div class="container">
    <h3 id="eventsHeading" class="section-heading">
      <!-- use events.png with fallback to evens.png if needed -->
      <img class="section-icon" src="images/events.png" alt="Events icon" onerror="this.onerror=null;this.src='images/evens.png';" />
      <span>Events & announcements</span>
    </h3>
        <p class="muted">Workshops, surveys and program launches â€” stay informed and register for trainings.</p>
        <div class="grid grid-3" id="eventsGrid" style="margin-top:12px;"></div>
        <p style="margin-top:14px"><a href="events.html">See events & blog posts â†’</a></p>
      </div>
    </section>
<!-- =========================
     OUR PARTNERSHIPS (HOME)
     ========================= -->
     <section id="home-partners" class="section">
      <div class="container">
        <div class="card">
    
          <!-- Heading + explanation -->
          <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-start">
            <div>
              <h3 style="margin:0 0 6px">Our partnerships</h3>
              <p class="muted" style="margin:0">
                We collaborate with trusted organisations to strengthen eye care services across Somalia.
              </p>
            </div>
            <a class="btn" href="partnership.html">More partnerships â†’</a>
          </div>
    
          <!-- Carousel -->
          <div class="partners-carousel">
            <button class="partner-btn prev" aria-label="Previous">â€¹</button>
    
            <div class="partners-viewport" id="partnersViewport" tabindex="0" aria-roledescription="carousel">
              <div class="partners-track" id="partnersTrack"></div>
            </div>
    
            <button class="partner-btn next" aria-label="Next">â€º</button>
          </div>
    
          <style>
            /* layout */
            .partners-carousel {
              position: relative;
              margin-top: 16px;
              display: flex;
              align-items: center;
            }
    
            .partners-viewport {
              overflow: hidden;
              width: 100%;
            }
    
            .partners-track {
              display: flex;
              gap: 16px;
              transition: transform .45s ease;
              will-change: transform;
              align-items: stretch;
              padding: 6px 0;
            }
    
            /* partner item wrapper (anchor) */
            .partner-item {
              flex: 0 0 auto;
              background: transparent;
              border-radius: 12px;
              display: block;
              text-decoration: none;
              color: inherit;
              outline: none;
            }
    
            /* the flipping card */
            .partner-card {
              width: 100%;
              height: 120px;
              border-radius: 12px;
              border: 1px solid rgba(0,0,0,.06);
              background: #fff;
              box-shadow: 0 6px 18px rgba(0,0,0,.06);
              transform-style: preserve-3d;
              transition: transform .5s;
              position: relative;
              display: flex;
              align-items: center;
              justify-content: center;
              padding: 12px;
              backface-visibility: hidden;
              -webkit-backface-visibility: hidden;
            }
    
            .partner-front,
            .partner-back {
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              display: flex;
              align-items: center;
              justify-content: center;
              padding: 12px;
              border-radius: 12px;
              backface-visibility: hidden;
              -webkit-backface-visibility: hidden;
            }
    
            .partner-front img {
              max-width: 100%;
              max-height: 80px;
              object-fit: contain;
              display: block;
            }
    
            .partner-back {
              transform: rotateY(180deg);
              flex-direction: column;
              gap: 6px;
              text-align: center;
              padding: 14px;
              background: linear-gradient(180deg, #ffffff 0%, #f7f7f7 100%);
            }
    
            .partner-back h4 {
              margin: 0;
              font-size: 14px;
            }
    
            .partner-back p {
              margin: 0;
              font-size: 12px;
              color: #555;
            }
    
            /* flipped state (applies on mobile click or JS toggled) */
            .partner-card.flipped {
              transform: rotateY(180deg);
            }
    
            /* buttons */
            .partner-btn {
              position: absolute;
              top: 50%;
              transform: translateY(-50%);
              width: 44px;
              height: 44px;
              border-radius: 50%;
              border: none;
              background: #fff;
              color: #0f766e;
              font-size: 22px;
              cursor: pointer;
              box-shadow: 0 8px 24px rgba(0,0,0,.15);
              z-index: 5;
            }
    
            .partner-btn.prev { left: -10px; }
            .partner-btn.next { right: -10px; }
    
            /* responsive widths
               desktop: 3 items
               mobile: 1 item
            */
            @media (min-width: 881px) {
              /* for 3 per view: total horizontal gaps = 16 * (3 - 1) = 32px */
              .partner-item { width: calc((100% - 32px) / 3); }
              .partner-card { height: 140px; }
            }
    
            @media (max-width: 880px) {
              .partner-item { width: 100%; }
              .partner-card { height: 120px; }
            }
    
            /* Only enable hover flip for devices that support hover (avoids conflicts on touch) */
            @media (hover: hover) {
              .partner-item:hover .partner-card { transform: rotateY(180deg); }
            }
          </style>
    
          <script>
            (function () {
              const partners = [
                { img: 'images/images-ac-hospital.png', link: 'https://aah.so/', name: 'AC Hospital', desc: 'Clinical partner - eye surgery & outreach' },
                { img: 'images/images-arag-hospital.png', link: 'partnership.html', name: 'Arag Hospital', desc: 'Community screening partner' },
                { img: 'images/images-hormuud-doundation.png', link: 'https://hormuudsalaamfoundation.org/', name: 'Hormuud Foundation', desc: 'Funding & health programs' },
                { img: 'images/images-acu-university.png', link: 'https://aaiu.edu.so/', name: 'ACU University', desc: 'Training & research collaboration' },
                { img: 'images/images-bright-foundation.png', link: 'partnership.html', name: 'Bright Foundation', desc: 'Local project support' },
                { img: 'images/images-ministry-of-health.png', link: 'https://moh.gov.so/so/home/', name: 'Ministry of Health', desc: 'National health policy partner' }
              ];
    
              const track = document.getElementById('partnersTrack');
              const viewport = document.getElementById('partnersViewport');
              const prevBtn = document.querySelector('.partner-btn.prev');
              const nextBtn = document.querySelector('.partner-btn.next');
    
              let perView = window.innerWidth <= 880 ? 1 : 3;
              let index = perView;
              const GAP = 16; // must match CSS gap
    
              // detect touch device
              const isTouch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
    
              function build() {
                track.innerHTML = '';
                perView = window.innerWidth <= 880 ? 1 : 3;
    
                const clonesStart = partners.slice(-perView);
                const clonesEnd = partners.slice(0, perView);
                const all = [...clonesStart, ...partners, ...clonesEnd];
    
                all.forEach((p, i) => {
                  // use data attributes for name/desc for back content
                  const itemHTML = `
                    <a class="partner-item" href="${p.link}" data-name="${escapeHtml(p.name)}" data-desc="${escapeHtml(p.desc)}" aria-label="${escapeHtml(p.name)}">
                      <div class="partner-card" role="group" aria-hidden="false">
                        <div class="partner-front">
                          <img src="${p.img}" alt="${escapeAttr(p.name)} logo" loading="lazy">
                        </div>
                        <div class="partner-back">
                          <h4>${escapeHtml(p.name)}</h4>
                          <p>${escapeHtml(p.desc)}</p>
                        </div>
                      </div>
                    </a>
                  `;
                  track.insertAdjacentHTML('beforeend', itemHTML);
                });
    
                index = perView;
                // position without animation
                requestAnimationFrame(() => update(true));
                attachInteractionHandlers();
              }
    
              function update(noAnim = false) {
                const item = track.children[0];
                if (!item) return;
                const w = item.offsetWidth + GAP;
                if (noAnim) track.style.transition = 'none';
                track.style.transform = `translateX(${-index * w}px)`;
                if (noAnim) requestAnimationFrame(() => track.style.transition = '');
              }
    
              function step(dir) {
                index += dir;
                update();
              }
    
              track.addEventListener('transitionend', () => {
                const total = partners.length;
                if (index >= total + perView) {
                  index = perView;
                  update(true);
                }
                if (index < perView) {
                  index = total + perView - 1;
                  update(true);
                }
              });
    
              prevBtn.addEventListener('click', () => step(-1));
              nextBtn.addEventListener('click', () => step(1));
    
              window.addEventListener('resize', () => {
                // rebuild on resize so clones match perView
                build();
              });
    
              // Interaction: hover flips on desktop (CSS handles it).
              // For touch devices: single tap toggles flip, double-tap navigates.
              let lastTap = 0;
              function attachInteractionHandlers() {
                // remove any existing handlers first (in case of rebuild)
                Array.from(track.querySelectorAll('.partner-item')).forEach(a => {
                  a.onclick = null;
                  a.ontouchstart = null;
                  a.querySelector('.partner-card').classList.remove('flipped');
                });
    
                if (isTouch) {
                  // handle touch/click behavior for mobile
                  Array.from(track.querySelectorAll('.partner-item')).forEach(a => {
                    a.addEventListener('click', function (ev) {
                      // detect double click/tap
                      const now = Date.now();
                      const dt = now - lastTap;
                      lastTap = now;
                      // if double-tap (within 350ms) -> navigate to link
                      if (dt > 0 && dt <= 350) {
                        // allow navigation
                        // don't preventDefault - just let it follow the anchor
                        return;
                      }
                      // single tap: toggle flipped state and prevent following link
                      ev.preventDefault();
                      const card = this.querySelector('.partner-card');
                      card.classList.toggle('flipped');
                    });
                  });
                } else {
                  // desktop: ensure clicking the anchor navigates (default behavior).
                  // but we still want to allow keyboard focus to flip/back? We'll keep default.
                  // no JS needed for hover flips (handled by CSS media query).
                }
              }
    
              // small helpers to escape HTML attributes/content to avoid broken markup
              function escapeHtml(s) {
                return String(s)
                  .replaceAll('&', '&amp;')
                  .replaceAll('<', '&lt;')
                  .replaceAll('>', '&gt;');
              }
              function escapeAttr(s) {
                return String(s)
                  .replaceAll('"', '&quot;')
                  .replaceAll("'", '&#39;')
                  .replaceAll('<', '&lt;')
                  .replaceAll('>', '&gt;');
              }
    
              // initial build
              build();
    
              // initial positioning after fonts/images load (safer)
              window.addEventListener('load', () => update(true));
    
              // Accessibility: keyboard left/right to move when viewport focused
              viewport.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') { e.preventDefault(); step(-1); }
                if (e.key === 'ArrowRight') { e.preventDefault(); step(1); }
              });
            })();
          </script>
    
        </div>
      </div>
    </section>
    
    
    
  </main>


  <!-- Add this markup once (near end of <body>) -->
<div id="sehaImageModal" class="seha-image-modal" aria-hidden="true" role="dialog">
  <button id="sehaImageModalClose" class="seha-image-modal-close" aria-label="Close image">âœ•</button>
  <img id="sehaImageModalImg" src="" alt="">
</div>

<style>
/* simple lightbox styles */
.seha-image-modal {
  position: fixed;
  inset: 0;
  display:none;
  align-items:center;
  justify-content:center;
  background: rgba(2,6,23,0.75);
  z-index: 12000;
  padding: 20px;
}
.seha-image-modal.open { display:flex; }
.seha-image-modal img { max-width: calc(100% - 40px); max-height: calc(100% - 80px); border-radius:10px; box-shadow:0 30px 80px rgba(2,6,23,0.6); }
.seha-image-modal-close {
  position: absolute;
  top: 18px;
  right: 18px;
  z-index: 12100;
  background:#fff; border-radius:999px; border:0; width:44px;height:44px; cursor:pointer;
  box-shadow:0 8px 24px rgba(2,6,23,0.3);
}
</style>

<script>
(function () {
  // wire program grid images to open modal when clicked
  const modal = document.getElementById('sehaImageModal');
  const modalImg = document.getElementById('sehaImageModalImg');
  const modalClose = document.getElementById('sehaImageModalClose');

  function openModal(src, alt) {
    if (!modal || !modalImg) return;
    modalImg.src = src;
    modalImg.alt = alt || '';
    modal.classList.add('open');
    modal.setAttribute('aria-hidden', 'false');
    modalClose.focus();
  }

  function closeModal() {
    if (!modal) return;
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden', 'true');
    // clear src to stop downloads on mobile
    modalImg.src = '';
  }

  // attach handlers (safe: run whenever images exist)
  function attachProgramImageClicks() {
    const imgs = document.querySelectorAll('#programGrid .program-card img');
    imgs.forEach(img => {
      // don't duplicate handlers
      if (img.dataset.sehaLightbox) return;
      img.dataset.sehaLightbox = '1';
      img.style.cursor = 'zoom-in';
      img.addEventListener('click', (e) => {
        // open original image (use data-full if you have a larger version)
        const full = img.dataset.full || img.src;
        openModal(full, img.alt || '');
      });
    });
  }

  // initial attach + also observe for future programGrid changes
  attachProgramImageClicks();

  // observe programGrid for added images (if your script dynamically injects)
  const pg = document.getElementById('programGrid');
  if (pg && window.MutationObserver) {
    const ob = new MutationObserver(() => attachProgramImageClicks());
    ob.observe(pg, { childList:true, subtree:true });
  }

  modalClose && modalClose.addEventListener('click', closeModal);
  modal && modal.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
})();
</script>


<!-- ====== Modern footer (replace existing footer) ====== -->
<footer class="site-footer" role="contentinfo" aria-labelledby="footer-heading">
  <div class="container footer-top" id="footerTop">
    <!-- col 1: logo + short mission -->
    <div class="footer-block footer-brand" aria-labelledby="footer-brand">
      <img src="images/logo.png" alt="SEHA logo" class="footer-logo" />
      <div class="footer-slogan">
        <p class="muted">
          Saving sight â€¢ Building local capacity across Somalia. SEHA coordinates local clinics,
          trains teams, and supports affordable optical services and safe cataract surgery across regions.
        </p>
        <p class="muted" style="margin-top:8px;font-size:13px">
          We prioritise locally-led solutions, transparent reporting and practical toolkits so services keep working long after visits end.
        </p>
      </div>
    </div>

    <!-- col 2: quick links -->
    <nav class="footer-block footer-links" aria-label="Footer quick links">
      <h4 class="footer-heading">Quick links</h4>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About Us</a></li>
        <li><a href="programs.html">Programs</a></li>
        <li><a href="resources.html">Resources</a></li>
        <li><a href="membership.html">Membership</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>

    <!-- col 3: contact + socials -->
    <div class="footer-block footer-contact" aria-labelledby="footer-contact">
      <h4 class="footer-heading">Contact</h4>
      <address class="muted">
        Mogadishu, Somalia<br />
        <a href="mailto:info@somalieyehealthalliance.org">info@somalieyehealthalliance.org</a><br />
        <a href="tel:+252617000264">+252 61 7000264</a>
      </address>

      <div class="footer-socials" aria-label="Contact & messaging">
        <!-- WhatsApp -->
        <a href="https://wa.me/252617000264" class="social" aria-label="WhatsApp" title="Chat on WhatsApp" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true">
            <path d="M20.52 3.48A11.93 11.93 0 0 0 12 0C5.373 0 .051 4.893 0 11.15 0 13.619.737 15.983 2.12 17.94L0 24l6.27-2.07A11.94 11.94 0 0 0 12 24c6.627 0 11.999-4.893 12-11.15 0-1.84-.46-3.6-1.48-5.37zM12 22.1c-1.67 0-3.29-.43-4.72-1.25l-.34-.2-3.72 1.23 1.24-3.63-.22-.37A9.07 9.07 0 0 1 2.9 11.15 9.1 9.1 0 0 1 12 2.1c4.83 0 8.8 3.45 8.8 9.05 0 5.59-3.97 10-8.8 10z"/>
            <path d="M17.2 14.85c-.3-.15-1.78-.87-2.06-.97-.28-.1-.48-.15-.68.15s-.78.97-.95 1.17c-.17.2-.34.23-.63.08-.3-.15-1.27-.47-2.42-1.51-.89-.8-1.49-1.78-1.66-2.08-.17-.3-.02-.46.13-.61.13-.13.3-.34.45-.51.15-.17.2-.28.3-.46.1-.17.05-.33-.03-.48-.08-.15-.68-1.64-.93-2.23-.24-.59-.48-.51-.66-.52-.17-.01-.36-.01-.55-.01-.2 0-.52.07-.8.34-.28.27-1.06 1.04-1.06 2.52 0 1.49 1.09 2.93 1.24 3.13.15.2 2.14 3.4 5.2 4.77 3.07 1.36 3.07.9 3.62.84.55-.06 1.78-.72 2.03-1.41.24-.69.24-1.28.17-1.41-.07-.14-.28-.24-.58-.39z"/>
          </svg>
        </a>

        <!-- Email quick action (same as contact, quick open mail client) -->
        <a href="mailto:info@somalieyehealthalliance.org" class="social" aria-label="Email" title="Send email">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true"><path d="M2 6.5C2 5.67 2.67 5 3.5 5h17c.83 0 1.5.67 1.5 1.5v11c0 .83-.67 1.5-1.5 1.5h-17C2.67 19 2 18.33 2 17.5v-11zM4 7v.8l7.5 5.1c.2.15.5.15.7 0L20 7.8V7H4z"/></svg>
        </a>
      </div>
    </div>
  </div>

  <!-- bottom legal bar -->
  <div class="footer-bottom" role="contentinfo">
    <div class="container footer-bottom-inner">
      <div class="legal muted">Â© 2026 Somali Eye Health Alliance â€” All rights reserved.</div>
      <div class="policies">
        <a href="privacy.html">Privacy</a>
        <span aria-hidden="true">â€¢</span>
        <a href="terms.html">Terms</a>
        <span aria-hidden="true">â€¢</span>
        <a href="developers-contact.html">Developers</a>
      </div>
    </div>
  </div>
</footer>






  <!-- Back to top button (floating) -->
  <button class="seha-back-to-top" id="sehaBackToTop" aria-label="Back to top" title="Back to top">
    <!-- up arrow SVG uses currentColor -->
    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="currentColor">
      <path d="M12 4l-8 8h5v8h6v-8h5z"/>
    </svg>
  </button>

    
<!-- help-widget.html -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
/* compact modern widget styles (mobile-first) */
/* ... same styles as before (omitted for brevity) ... */
#sehaHelpRoot { font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; position: fixed; right: 50px; bottom: 16px; z-index: 9999; }
/* ADDED: give the floating FAB a small right-margin to space it from the edge */
.seha-fab { width:46px;height:46px;border-radius:50%;background:#0f766e;color:#fff;border:0;box-shadow:0 8px 24px rgba(15,118,110,0.2); cursor:pointer; display:flex;align-items:center;justify-content:center;font-size:20px; margin-right:29px; margin-bottom: -15px; }

/* ADDED: ensure buttons inside the panel get a small right margin */
.seha-panel .btn, #sehaHelpPanel .btn { margin-right: 41px; }

.seha-panel { width:92vw; max-width:420px; height:72vh; max-height:760px; background:#fff;border-radius:12px;box-shadow:0 20px 40px rgba(2,6,23,0.12); display:flex;flex-direction:column; overflow:hidden; }
.seha-header { padding:12px 14px; border-bottom:1px solid #f0f3f5; display:flex; align-items:center; gap:10px; }
.seha-title { font-weight:700; font-size:16px; margin:0; }
.seha-sub { color:#6b7280; font-size:13px }
.seha-body { padding:12px; flex:1; overflow:auto; display:flex; flex-direction:column; gap:10px; background:linear-gradient(#fff,#fbfdfe); }
.convo { display:flex; flex-direction:column; gap:8px; }
.msg { max-width:78%; padding:10px 12px; border-radius:10px; background:#f3f9f8; font-size:14px; color:#033; box-shadow:0 2px 6px rgba(2,6,23,0.04) }
.msg.user { background:#0f766e; color:#fff; align-self:flex-end; border-radius:10px 10px 6px 10px; }
.small { font-size:13px; color:#6b7280 }
.controls { display:flex; gap:8px; flex-wrap:wrap; }
.btn { padding:8px 12px; border-radius:8px; border:0; background:#e6f6f4; color:#0f766e; cursor:pointer }
.btn.primary { background:#0f766e; color:#fff }
.footer { padding:10px; border-top:1px solid #f0f3f5; display:flex; gap:8px; align-items:center }
.input { flex:1; padding:8px 10px; border-radius:8px; border:1px solid #eef2f2 }
.hidden { display:none }
@media(min-width:900px){ #sehaHelpRoot { right:40px; bottom:40px; } .seha-panel { width:420px; height:68vh; } }
</style>





<div id="sehaHelpRoot" aria-live="polite">
  <button id="sehaHelpFab" class="seha-fab " aria-label="Open support chat">ðŸ’¬</button>
  <div id="sehaHelpPanel" class="seha-panel hidden" role="dialog" aria-modal="false" aria-label="Support chat">
    <div class="seha-header">
      <div style="display:flex;align-items:center;gap:10px">
        <div style="width:40px;height:40px;border-radius:8px;background:#e6f6f4;color:#0f766e;display:flex;align-items:center;justify-content:center;font-weight:700">S</div>
        <div>
          <div class="seha-title"> Somali Eye Health Alliance Support</div>
          <div class="seha-sub" id="sehaHelpSub">Ask for help â€” anonymous OK</div>
        </div>
      </div>
      <div style="margin-left:auto">
        <button id="sehaCloseBtn" style="background:transparent;border:0;color:#6b7280;cursor:pointer">âœ•</button>
      </div>
    </div>

    <div class="seha-body" id="sehaBody"></div>

    <div class="footer" id="sehaFooter">
      <input id="sehaInput" class="input" placeholder="Type a message..." />
      <button id="sehaSend" class="btn primary">Send</button>
    </div>
  </div>
</div>



  <script>
  /*
    Help FAB click routing:
    - Admin / Superadmin => open admin inbox page
    - Otherwise => open the help widget panel (so homepage remains visible)
  */
  (function(){
    function safeGetUser() {
      try { if (typeof window.getUser === 'function') return window.getUser(); } catch(e){}
      try { const u = localStorage.getItem('seha_user'); return u ? JSON.parse(u) : null; } catch(e){ return null; }
    }
    function safeGetToken() {
      try { if (typeof window.getToken === 'function') return window.getToken(); } catch(e){}
      return localStorage.getItem('seha_token') || null;
    }
  
    // find FAB and widget panel if present
    const fab = document.getElementById('sehaHelpFab');
    const panel = document.getElementById('sehaHelpPanel');
    const closeBtn = document.getElementById('sehaCloseBtn');
  
    function openWidgetPanel() {
      if (!panel || !fab) return;
      panel.classList.remove('hidden');
      fab.style.display = 'none';
      // focus input for better UX
      const input = panel.querySelector('#sehaInput');
      if (input) setTimeout(()=> input.focus(), 120);
    }
  
    function closeWidgetPanel() {
      if (!panel || !fab) return;
      panel.classList.add('hidden');
      fab.style.display = 'flex';
    }
  
    if (!fab) return; // nothing to wire
  
    fab.addEventListener('click', (e) => {
      // check role - prefer getUser() if available, fallback to token/json in storage
      const token = safeGetToken();
      const user = safeGetUser();
      const role = user && user.role ? String(user.role).toLowerCase() : null;
  
      if (token && (role === 'admin' || role === 'superadmin')) {
        // admin: open admin inbox in same tab
        // If you prefer new tab, change to window.open('/admin/help-inbox.html', '_blank')
        window.location.href = 'help-inbox.html';
        return;
      }
  
      // otherwise, show the normal user widget
      if (panel) {
        openWidgetPanel();
      } else {
        // If widget not present on this page, navigate to a page that hosts it
        window.location.href = 'help-widget.html';
      }
    });
  
    if (closeBtn) closeBtn.addEventListener('click', closeWidgetPanel);
  
    // Optional: allow keyboard ESC to close widget
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape' && panel && !panel.classList.contains('hidden')) closeWidgetPanel();
    });
  })();
  
  (function () {
  const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? 'http://localhost:4000' : '';

  // DOM
  const fab = document.getElementById('sehaHelpFab');
  const panel = document.getElementById('sehaHelpPanel');
  const closeBtn = document.getElementById('sehaCloseBtn');
  const body = document.getElementById('sehaBody');
  const sub = document.getElementById('sehaHelpSub');
  const input = document.getElementById('sehaInput');
  const send = document.getElementById('sehaSend');

  // local keys
  const localKeyAnon = 'seha_help_anon';
  const localConvKey = 'seha_help_conv';
  const sendQueueKey = 'seha_help_queue';

  // state
  let currentConv = null;
  let socket = null;
  let pollTimer = null;
  let loadExistingDebounce = 0;

  // helpers
  function safeGetUser() { try { if (typeof window.getUser === 'function') return window.getUser(); } catch(e){} try { const u = localStorage.getItem('seha_user'); return u ? JSON.parse(u) : null } catch(e) { return null } }
  function safeGetToken() { try { if (typeof window.getToken === 'function') return window.getToken(); } catch(e){} return localStorage.getItem('seha_token') || null; }
  function ensureAnon() {
    try {
      let anon = JSON.parse(localStorage.getItem(localKeyAnon) || 'null');
      if (!anon) { anon = { anonId: 'anon-' + Math.random().toString(36).slice(2,10), name: null }; localStorage.setItem(localKeyAnon, JSON.stringify(anon)); }
      return anon;
    } catch (e) { const anon = { anonId: 'anon-' + Math.random().toString(36).slice(2,10), name: null }; localStorage.setItem(localKeyAnon, JSON.stringify(anon)); return anon; }
  }
  function anonLabel(anonId) { if (!anonId) return 'Anonymous'; return 'Anonymous-' + String(anonId).slice(-6); }
  function escapeHtml(s) { if (!s) return ''; return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  /* Robust apiFetch with retry/backoff for 429 + transient errors */
  async function apiFetch(url, opts = {}, { retries = 2, backoff = 400 } = {}) {
    opts.headers = opts.headers || {};
    const token = safeGetToken();
    if (token) opts.headers['Authorization'] = 'Bearer ' + token;
    if (opts.body && !opts.headers['Content-Type']) opts.headers['Content-Type'] = 'application/json';
    opts.method = opts.method || (opts.body ? 'POST' : 'GET');

    let attempt = 0;
    while (attempt <= retries) {
      try {
        const res = await fetch((API_BASE || '') + url, opts);
        const json = await res.json().catch(()=>null);
        if (res.status === 429) { const wait = backoff * Math.pow(2, attempt); await new Promise(r => setTimeout(r, wait)); attempt++; continue; }
        return { ok: res.ok, status: res.status, data: json };
      } catch (err) {
        if (attempt < retries) { const wait = backoff * Math.pow(2, attempt); await new Promise(r => setTimeout(r, wait)); attempt++; continue; }
        return { ok:false, status:0, error: err };
      }
    }
    return { ok:false, status:429, error: 'Too many requests' };
  }

  /* queue helpers */
  function loadQueue() { try { return JSON.parse(localStorage.getItem(sendQueueKey) || '[]'); } catch(e) { return []; } }
  function saveQueue(q) { localStorage.setItem(sendQueueKey, JSON.stringify(q || [])); }
  function enqueueMessage(payload) { const q = loadQueue(); q.push(payload); saveQueue(q); }
  async function flushQueue() {
    const q = loadQueue();
    if (!q.length) return;
    const remaining = [];
    for (const item of q) {
      try {
        if (item.type === 'append' && item.convId) {
          const r = await apiFetch('/api/help/conversations/' + encodeURIComponent(item.convId) + '/messages', { method: 'POST', body: JSON.stringify({ text: item.text, topic: item.topic }) }, { retries: 3 });
          if (!r.ok) remaining.push(item); else {
            if (currentConv && String(currentConv._id) === String(item.convId)) { currentConv = r.data.conversation || currentConv; localStorage.setItem(localConvKey, JSON.stringify(currentConv)); renderMessages(currentConv.messages || []); }
          }
        } else if (item.type === 'create') {
          const r = await apiFetch('/api/help/conversations', { method: 'POST', body: JSON.stringify(item.payload) }, { retries: 3 });
          if (!r.ok) remaining.push(item); else { currentConv = r.data.conversation; localStorage.setItem(localConvKey, JSON.stringify(currentConv)); renderMessages(currentConv.messages || []); }
        }
      } catch (e) { remaining.push(item); }
    }
    saveQueue(remaining);
  }

  /* RENDERING */
  function renderMessages(messages) {
    body.innerHTML = '';
    const convDiv = document.createElement('div');
    convDiv.className = 'convo';
    if (!messages || messages.length === 0) {
      convDiv.innerHTML = '<div class="muted">No messages yet</div>';
    } else {
      messages.forEach(m => {
        const d = document.createElement('div');
        d.className = 'msg' + (m.sender === 'user' ? ' user' : '');
        const txt = document.createElement('div');
        txt.textContent = m.text || '';
        d.appendChild(txt);
        const meta = document.createElement('div');
        meta.className = 'muted';
        const who = m.senderName ? m.senderName : (m.sender === 'user' ? (currentConv && currentConv.name ? currentConv.name : anonLabel(currentConv && currentConv.anonId)) : 'Support');
        const t = m.createdAt ? new Date(m.createdAt).toLocaleString() : '';
        const topic = (m.meta && m.meta.topic) ? ` â€¢ ${m.meta.topic}` : '';
        meta.textContent = `${who}${topic} â€¢ ${t}`;
        d.appendChild(meta);
        convDiv.appendChild(d);
      });
    }
    body.appendChild(convDiv);
    body.scrollTop = body.scrollHeight;
  }

  function appendLocalMessage(msg) {
    currentConv.messages = currentConv.messages || [];
    currentConv.messages.push(msg);
    localStorage.setItem(localConvKey, JSON.stringify(currentConv));
    renderMessages(currentConv.messages || []);
  }

  /* FLOWS: welcome -> topic -> followup -> create conv */
  function showWelcomeFlow() {
    body.innerHTML = '';
    const el = document.createElement('div');
    el.innerHTML = `
      <div style="font-weight:700">How can we help?</div>
      <div class="muted" style="margin-bottom:8px">Choose a topic so we can route your message:</div>
      <div class="controls" id="topicBtns">
        <button class="btn" data-topic="Donation">Donation</button>
        <button class="btn" data-topic="Membership">Membership</button>
        <button class="btn" data-topic="Opportunities">Opportunities</button>
        <button class="btn" data-topic="Other">Other</button>
      </div>
      <div style="margin-top:8px" id="namePrompt"></div>
    `;
    body.appendChild(el);

    const anon = ensureAnon();
    const user = safeGetUser();
    const namePrompt = document.getElementById('namePrompt');

    if (!user) {
      namePrompt.innerHTML = `<div class="muted">What should we call you? (optional)</div>
        <div style="display:flex;gap:8px;margin-top:6px">
          <input id="visitorName" class="input" placeholder="Your name or leave anonymous" value="${anon.name ? escapeHtml(anon.name) : ''}" />
          <button id="saveVisitorName" class="btn">Save</button>
        </div>
        <div id="visitorSavedMsg" class="muted" style="margin-top:6px; display:${anon.name ? 'block' : 'none'}">Saved as <strong id="visitorSaved">${anon.name ? escapeHtml(anon.name) : ''}</strong></div>
      `;
      const inputEl = document.getElementById('visitorName');
      const saveBtn = document.getElementById('saveVisitorName');
      const savedMsg = document.getElementById('visitorSavedMsg');
      const savedNameSpan = document.getElementById('visitorSaved');

      saveBtn.addEventListener('click', () => {
        const val = (inputEl.value || '').trim();
        if (val) { anon.name = val; localStorage.setItem(localKeyAnon, JSON.stringify(anon)); savedNameSpan.textContent = val; savedMsg.style.display = 'block'; sub.textContent = 'Visitor: ' + val; }
        else { anon.name = null; localStorage.setItem(localKeyAnon, JSON.stringify(anon)); savedMsg.style.display = 'none'; sub.textContent = 'Ask for help â€” anonymous OK'; }
      });

      inputEl.addEventListener('keydown', (ev) => { if (ev.key === 'Enter') { ev.preventDefault(); saveBtn.click(); } });
    } else {
      sub.textContent = 'Logged in as ' + (user.fullName || user.name || 'You');
    }

    document.querySelectorAll('#topicBtns .btn').forEach(b => { b.addEventListener('click', () => askFollowUp(b.dataset.topic)); });
  }

  function askFollowUp(topic) {
    body.innerHTML = '';
    const wrapper = document.createElement('div');
    wrapper.innerHTML = `
      <div style="font-weight:700">${escapeHtml(topic)}</div>
      <div class="muted" style="margin-bottom:8px">Please tell us more about your ${escapeHtml(topic.toLowerCase())} question (short summary)</div>
      <textarea id="followText" rows="4" style="width:100%;padding:8px;border-radius:8px;border:1px solid #eef2f2"></textarea>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
        <button id="backTopic" class="btn">Back</button>
        <button id="startConv" class="btn primary">Start chat</button>
      </div>
    `;
    body.appendChild(wrapper);
    document.getElementById('backTopic').addEventListener('click', showWelcomeFlow);
    document.getElementById('startConv').addEventListener('click', async () => {
      const details = (document.getElementById('followText').value || '').trim();
      await startConversation(topic, details);
    });
  }

  async function startConversation(topic, details) {
    const anon = ensureAnon();
    const user = safeGetUser();
    const payload = { anonId: anon.anonId, initialMessage: details || ('Start: ' + topic), topic, details, name: anon.name || null };

    // optimistic UI
    currentConv = { localId:'local-'+Date.now(), anonId: anon.anonId, name: anon.name || null, messages: [{ sender:'user', text: payload.initialMessage, createdAt: new Date().toISOString(), senderName: payload.name || null, meta: { topic } }], meta: { topic, details } };
    localStorage.setItem(localConvKey, JSON.stringify(currentConv));
    renderMessages(currentConv.messages);

    // try create on server
    const r = await apiFetch('/api/help/conversations', { method:'POST', body: JSON.stringify(payload) }, { retries: 3 });
    if (!r.ok) {
      // enqueue create for later
      enqueueMessage({ type:'create', payload });
      startPolling();
      return;
    }
    currentConv = r.data.conversation;
    localStorage.setItem(localConvKey, JSON.stringify(currentConv));
    renderMessages(currentConv.messages || []);
    if (socket && currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
    flushQueue();
    startPolling();
  }

  /* Send message from input */
  async function sendMessageFromInput() {
    const txt = (input.value || '').trim();
    if (!txt) return;
    input.value = '';
    const anon = ensureAnon();
    const now = new Date().toISOString();
    const msg = { _id: 'm-' + Date.now(), sender:'user', text: txt, createdAt: now, status: 'pending', senderName: (currentConv && currentConv.name) ? currentConv.name : (anon.name || null), meta: (currentConv && currentConv.meta) ? currentConv.meta : null };
    if (!currentConv) currentConv = { localId:'local-'+Date.now(), anonId: anon.anonId, messages: [] };
    appendLocalMessage(msg);

    // if server conv exists
    if (currentConv._id) {
      const r = await apiFetch('/api/help/conversations/' + encodeURIComponent(currentConv._id) + '/messages', { method:'POST', body: JSON.stringify({ text: txt }) }, { retries: 2 });
      if (r.ok && r.data && r.data.conversation) {
        currentConv = r.data.conversation;
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        renderMessages(currentConv.messages || []);
        flushQueue();
        return;
      } else {
        enqueueMessage({ type:'append', convId: currentConv._id, text: txt, topic: (currentConv.meta && currentConv.meta.topic) ? currentConv.meta.topic : undefined });
        const last = currentConv.messages[currentConv.messages.length -1];
        if (last) last.status = 'failed';
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        renderMessages(currentConv.messages || []);
        startPolling();
        return;
      }
    }

    // else create conv with initial message
    const payload = { anonId: anon.anonId, initialMessage: txt, topic: (currentConv && currentConv.meta) ? currentConv.meta.topic : undefined, details: (currentConv && currentConv.meta) ? currentConv.meta.details : undefined, name: anon.name || undefined };
    const r2 = await apiFetch('/api/help/conversations', { method:'POST', body: JSON.stringify(payload) }, { retries: 3 });
    if (r2.ok && r2.data && r2.data.conversation) {
      currentConv = r2.data.conversation;
      localStorage.setItem(localConvKey, JSON.stringify(currentConv));
      renderMessages(currentConv.messages || []);
      if (socket && currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
      flushQueue();
      return;
    } else {
      enqueueMessage({ type:'create', payload });
      startPolling();
      return;
    }
  }

  /* POLLING + SOCKET fallback */
  function startPolling() { if (pollTimer) return; pollTimer = setInterval(async () => { await flushQueue(); const nowt = Date.now(); if (nowt - loadExistingDebounce > 2500) { loadExistingDebounce = nowt; await loadExisting(false).catch(()=>{}); } }, 3500); }
  function stopPolling() { if (pollTimer) { clearInterval(pollTimer); pollTimer = null; } }

  async function loadExisting(focus = true) {
    const user = safeGetUser();
    const anon = ensureAnon();
    const token = safeGetToken();

    if (token) {
      const r = await apiFetch('/api/help/conversations/me');
      if (r.ok && r.data && r.data.conversation) {
        currentConv = r.data.conversation;
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        sub.textContent = 'Logged in as ' + (user && (user.fullName || user.name) ? (user.fullName || user.name) : 'You');
        renderMessages(currentConv.messages || []);
        if (socket && currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
        return;
      } else if (r.status === 404) { /* no conv */ } else if (r.status === 429) { return; }
    }

    const raw = localStorage.getItem(localConvKey);
    if (raw) {
      try { currentConv = JSON.parse(raw); renderMessages(currentConv.messages || []); return; } catch(e){ currentConv = null; }
    }

    const r2 = await apiFetch('/api/help/conversations/anon/' + encodeURIComponent(anon.anonId));
    if (r2.ok && r2.data && r2.data.conversation) {
      currentConv = r2.data.conversation;
      localStorage.setItem(localConvKey, JSON.stringify(currentConv));
      renderMessages(currentConv.messages || []);
      if (socket && currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
      return;
    }

    showWelcomeFlow();
    startPolling();
  }

  function loadSocketIoClient(cb) {
    if (window.io) return cb(null);
    const tryUrls = [];
    if (API_BASE) tryUrls.push(API_BASE + '/socket.io/socket.io.js');
    tryUrls.push('https://cdn.socket.io/4.6.1/socket.io.min.js');
    let i = 0;
    function next() {
      if (i >= tryUrls.length) return cb(new Error('socket.io client failed to load'));
      const src = tryUrls[i++];
      const s = document.createElement('script'); s.src = src; s.async = true;
      s.onload = () => { if (window.io) return cb(null); else next(); };
      s.onerror = () => { console.warn('socket.io client failed load:', src); next(); };
      document.head.appendChild(s);
    }
    next();
  }

  function initSocket() {
    if (!window.io) return;
    const token = safeGetToken();
    socket = io(API_BASE || '/', { auth: token ? { token } : undefined, transports: ['websocket','polling'] });

    socket.on('connect', () => {
      if (currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
      stopPolling();
    });

    socket.on('help.message', (data) => {
      if (!data || !data.conversationId) return;
      if (currentConv && String(currentConv._id) === String(data.conversationId)) {
        currentConv.messages = currentConv.messages || [];
        if (data.message) currentConv.messages.push(data.message);
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        renderMessages(currentConv.messages || []);
      }
    });

    socket.on('help.updated', (data) => {
      if (data && data.conversation && currentConv && String(currentConv._id) === String(data.conversation._id)) {
        currentConv = data.conversation;
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        renderMessages(currentConv.messages || []);
      }
    });

    socket.on('connect_error', (err) => { console.warn('socket connect_error', err && err.message ? err.message : err); startPolling(); });
    socket.on('disconnect', () => startPolling());
  }

  /* UI wiring */
  if (fab) {
    fab.addEventListener('click', async () => {
      panel.classList.remove('hidden');
      fab.style.display = 'none';
      loadSocketIoClient((err) => { if (!err) initSocket(); else startPolling(); });
      await loadExisting();
    });
  }

  if (closeBtn) closeBtn.addEventListener('click', () => {
    panel.classList.add('hidden');
    fab.style.display = 'flex';
    stopPolling();
  });

  if (send) send.addEventListener('click', sendMessageFromInput);
  if (input) input.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessageFromInput(); } });

  (function preInit() {
    const user = safeGetUser();
    if (user && (user.fullName || user.name)) sub.textContent = 'Signed in as ' + (user.fullName || user.name);
    const raw = localStorage.getItem(localConvKey);
    if (raw) {
      try { currentConv = JSON.parse(raw); renderMessages(currentConv.messages || []); } catch(e){ /* ignore */ }
    } else { showWelcomeFlow(); }
    setTimeout(flushQueue, 600);
  })();

  // expose helpers (debug)
  window.__seha_help = { ensureAnon, getCurrentConv: () => currentConv, startPolling, stopPolling, flushQueue };

})();

(function() {
  // formatting helper with locale-aware thousands separator
  const fmt = (n) => new Intl.NumberFormat().format(Math.round(n));

  // count-up animation function
  function animateCount(el, start, end, duration = 1400, suffix = '') {
    const startTime = performance.now();
    function tick(now) {
      const elapsed = now - startTime;
      const progress = Math.min(elapsed / duration, 1);
      // easeOutCubic
      const eased = 1 - Math.pow(1 - progress, 3);
      const value = start + (end - start) * eased;
      el.textContent = fmt(value);
      if (progress < 1) {
        requestAnimationFrame(tick);
      } else {
        // ensure final exact value
        el.textContent = fmt(end);
        if (suffix) {
          // suffix displayed in separate .suffix element already
        }
      }
    }
    requestAnimationFrame(tick);
  }

  // Find all counters
  const counters = Array.from(document.querySelectorAll('.stat .count'));
  if (!counters.length) return;

  // IntersectionObserver to trigger when stats visible
  const io = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) return;
      const span = entry.target;
      const target = parseInt(span.dataset.target || '0', 10) || 0;
      const suffix = span.dataset.suffix || '';
      // guard â€” prevent double animation
      const parentStat = span.closest('.stat');
      if (parentStat && parentStat.dataset.animated === 'true') {
        obs.unobserve(span);
        return;
      }
      // animate
      animateCount(span, 0, target, 1500, suffix);
      if (parentStat) parentStat.dataset.animated = 'true';
      // unobserve this counter
      obs.unobserve(span);
    });
  }, { threshold: 0.4 });

  counters.forEach(c => io.observe(c));
})();





  </script>

  <script>
(function(){
  const el = document.querySelector('.grid-3');
  const infoBoxId = 'seha-diagnostic-box';
  if(document.getElementById(infoBoxId)) return;
  const box = document.createElement('div');
  box.id = infoBoxId;
  box.style.position = 'fixed';
  box.style.zIndex = 99999;
  box.style.left = 8 + 'px';
  box.style.top = 8 + 'px';
  box.style.background = 'rgba(0,0,0,0.7)';
  box.style.color = '#fff';
  box.style.padding = '8px 10px';
  box.style.borderRadius = '8px';
  box.style.fontSize = '13px';
  box.style.lineHeight = '1.2';
  box.style.maxWidth = 'calc(100% - 16px)';
  if(!el){
    box.textContent = '.grid-3 NOT FOUND on this page';
    document.body.appendChild(box);
    return;
  }
  const cs = getComputedStyle(el);
  const cols = cs.getPropertyValue('grid-template-columns') || 'n/a';
  box.innerHTML = '<strong>.grid-3</strong><br>grid-template-columns: ' + cols;
  document.body.appendChild(box);
})();
</script>

  <script src="script.js"></script>
</body>
</html>
