<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Somali Eye Health Alliance (SEHA)</title>
  <meta name="description" content="Somali Eye Health Alliance â€” protecting and restoring sight across Somalia. Programs, partners, volunteering and community outreach." />
  <link rel="icon" href="images/logo.png">
  <link rel="stylesheet" href="style.css">

  <style>
    /* Section heading icons + consistent sizing */
    .section-heading {
      display:flex;
      align-items:center;
      gap:12px;
      margin:0 0 8px 0;
      font-size:20px;
      font-weight:800;
      color:var(--text, #0b1220);
    }
    .section-heading img.section-icon {
      width:44px;
      height:44px;
      object-fit:contain;
      flex:0 0 44px;
      border-radius:8px;
      background:transparent;
    }
    
    /* Small tweak to ensure same text size for h3/h4 across these blocks */
    .container h3, .container h4, .section .section-heading { font-size:20px; }
    
    /* Impact stats row â€” centered with large colored numbers */
    .stats-row {
      display:flex;
      gap:14px;
      justify-content:center;
      align-items:stretch;
      flex-wrap:wrap;
    }
    .stat {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:18px;
      min-width:180px;
      border-radius:10px;
      background: linear-gradient(180deg, var(--card, #fff), var(--card, #fff));
      border:1px solid var(--input-border, #eef2f2);
      box-shadow:var(--surface-shadow, 0 6px 18px rgba(2,6,23,0.04));
      text-align:center;
    }
    
    /* Number styling */
    .stat-number {
      font-size:34px;
      font-weight:900;
      line-height:1;
      margin-bottom:6px;
      letter-spacing:0.6px;
    }
    
    /* small muted caption under numbers */
    .stat .muted { font-size:13px; color:var(--muted,#6b7280); }
    
    /* Color variants */
    .stat-number.teal { color: var(--accent, #0f766e); }
    .stat-number.blue  { color: #2563eb; }   /* blue */
    .stat-number.orange { color: #d97706; }  /* amber/orange */
    
    /* Make sure counts remain centered on small screens */
    @media (max-width:760px){
      .stats-row { gap:10px; }
      .stat { min-width:140px; padding:14px; }
      .stat-number { font-size:28px; }
    }
    
    /* Uniform small icon style for program/explore/resource cards */
    .card .card-heading {
      display:flex;
      align-items:center;
      gap:10px;
    }
    .card .card-heading img.icon {
      width:36px;height:36px;object-fit:contain;border-radius:6px;
    }
    
    /* small caption under map/title icons */
    .section .caption { margin-top:8px; color:var(--muted,#6b7280); }
    
    /* Accessibility focus */
    .section-heading:focus, .card a:focus, .card button:focus { outline: 3px solid rgba(45,212,191,0.12); outline-offset:4px; }
    
    /* Dark mode compatibility (prefers-color-scheme) */
    @media (prefers-color-scheme: dark) {
      .stat { background: linear-gradient(180deg, var(--card,#0b2630), var(--card,#0b2630)); border-color: var(--input-border,#153034); box-shadow: 0 6px 18px rgba(0,0,0,0.6); }
      .section-heading { color: var(--text,#e7f8f5); }
      .stat .muted { color: var(--muted,#9fb6b3); }
    }
    
    /* ensure program grid headings use same sized icon */
    .grid .program-card .card-heading img.icon { width:40px; height:40px; }
    
    /* small helper for recent highlight image */
    .recent-highlight {
      display:flex;
      gap:12px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .recent-highlight img { width:220px; max-width:100%; border-radius:8px; object-fit:cover; }
    </style>
    
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const current = window.location.pathname.split("/").pop(); 
      document.querySelectorAll(".main-nav a").forEach(a => {
        const href = a.getAttribute("href");
        if (href === current) {
          a.classList.add("active");
        }
      });
    });
    </script>
    
  <!-- START: Back-to-top small styles (optional: move into style.css) -->
  <style>
    /* Floating "back to top" button */
    .seha-back-to-top {
      position: fixed;
      right: 20px;
      bottom: 24px;
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--primary);
      color: #fff;
      box-shadow: 0 10px 30px rgba(2,6,23,0.12);
      cursor: pointer;
      z-index: 1600;
      opacity: 0;
      pointer-events: none;
      transform: translateY(8px);
      transition: opacity .18s ease, transform .18s ease;
      border: 0;
    }

    .seha-back-to-top.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    /* focus / keyboard visibility */
    .seha-back-to-top:focus {
      outline: 3px solid rgba(45,212,191,0.22);
      outline-offset: 4px;
    }

    /* inner svg */
    .seha-back-to-top svg { width: 20px; height: 20px; display:block; }

    /* small responsive tweak so it doesn't overlap on very small screens */
    @media (max-width: 420px) {
      .seha-back-to-top { right: 12px; bottom: 16px; width:44px; height:44px; border-radius:10px; }
    }

    /* optional: hide if user prefers reduced motion */
    @media (prefers-reduced-motion: reduce) {
      .seha-back-to-top { transition: none; }
      html { scroll-behavior: auto; }
    }
    /* === Small/tight desktop header patch â€” only layout + sizing === */
/* Apply only on desktop so mobile/menu/toggles are untouched */
@media (min-width: 981px) {

/* tighten header row and flush container edges */
.site-header { padding: 0; }
.container.header-inner { padding: 0 6px; max-width: var(--container); }

/* reduce overall header height and gaps */
.header-inner {
  height: 52px;            /* slightly shorter */
  gap: 8px;
  padding: 0;
  align-items: center;
}

/* branding: smaller logo and reduced text sizes */
.brand { gap: 8px; min-width: 0; }
.brand .logo { width: 34px; height: 34px; border-radius: 6px; }
.brand-text .org-name {
  font-size: 11px;         /* smaller title */
  font-weight: 700;
  line-height: 1;
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}
.brand-text .tagline {
  font-size: 10px;         /* smaller tagline */
  margin: 0;
  opacity: 0.9;
}

/* navigation: smaller font, tighter padding and smaller gap */
.main-nav { flex: 1 1 auto; min-width: 0; }
.main-nav .nav-list {
  gap: 6px;                /* tighter gap between menu items */
  padding: 0 6px;
}
.main-nav a {
  font-size: 12px;         /* smaller nav text */
  padding: 6px 8px;        /* tighter clickable area */
  border-radius: 6px;
  font-weight: 700;
}

/* reduce the hover transform so it looks subtle on small header */
.main-nav a:hover, .main-nav a:focus {
  transform: translateY(-1px);
  background: rgba(15,118,110,0.04);
}

/* ensure desktop popovers still position correctly (no clipping) */
.nav-item { position: relative; }
.nav-subtitle {
  left: 50%;
  transform: translateX(-50%) translateY(6px);
  top: calc(100% + 6px);
  min-width: 180px;
  z-index: 2500;
}
}

/* Keep mobile rules exactly as before (no changes) */
@media (max-width: 980px) {
/* nothing here â€” mobile behavior unchanged */
}

/* === ACTIVE NAVIGATION HIGHLIGHT === */
@media (min-width: 981px) {
  .main-nav a.active {
    background: var(--primary-light, rgba(15,118,110,0.10));
    color: var(--primary, #0f766e);
    transform: none;       /* don't move up when active */
  }

  /* optional: keep hover consistent */
  .main-nav a.active:hover {
    background: var(--primary-light, rgba(15,118,110,0.12));
    color: var(--primary, #0f766e);
  }
}



  </style>

<style>
  /* small tweak so the animated numbers and suffix align nicely */
  .stat-number { display:flex; align-items:baseline; gap:6px; justify-content:center; }
  .stat-number .count { display:inline-block; min-width:3ch; text-align:center; }
  .stat-number .suffix { font-weight:700; opacity:0.95; font-size:0.7em; margin-left:2px; color:inherit; }
  
  /* optional: a subtle entrance animation for the stat card when it appears */
  .stat[data-animated="true"] { transform: translateY(0); opacity:1; transition: transform .42s cubic-bezier(.2,.9,.2,1), opacity .38s ease; }
  .stat { transform: translateY(6px); opacity:0; }
  </style>
  
  <!-- END: Back-to-top styles -->
</head>
<body>
 <!-- HEADER -->
<header class="site-header" role="banner">
  
  <!-- small, safe header-local CSS to avoid duplicate arrows & show mobile toggle only on small screens -->
  <style>
    /* If your global CSS also sets .nav-item.has-sub > a::after, override here so we don't get double arrows */
    .nav-item.has-sub > a::after { content: ''; }

    /* mobile-only helper: hide by default (desktop) and show only under your mobile breakpoint */
    .mobile-only { display: none; align-items: center; gap: 8px; }
    @media (max-width: 880px) {
      .mobile-only { display: flex; }
      /* ensure desktop popover remains visible on hover as before */
      .nav-item.has-sub > .nav-subtitle { display: none; }
      .nav-item.has-sub:hover > .nav-subtitle,
      .nav-item.has-sub:focus-within > .nav-subtitle { display: block; }
    }
  </style>

  <div class="container header-inner">
    <div class="brand">
      <img src="images/logo.png" alt="SEHA logo" class="logo" />
      <div class="brand-text">
        <h1 class="org-name">Somali Eye Health Alliance</h1>
        <p class="tagline">Saving sight â€¢ Building local capacity</p>
      </div>
    </div>

    <nav class="main-nav" role="navigation" aria-label="Main Navigation">
      <ul class="nav-list">
        <li class="nav-item"><a href="index.html">Home</a></li>

        <li class="nav-item has-sub" id="nav-about">
          <a href="about.html" aria-haspopup="true" aria-expanded="false">About Us â–¾</a>

          <!-- desktop popover -->
          <div class="nav-subtitle" role="dialog" aria-hidden="true" aria-labelledby="about-subtitle">
            <ul class="subtitle-list">
              <li><a href="about.html#who" class="subtitle-link">Who we are</a></li>
              <li><a href="about.html#what-we-do" class="subtitle-link">What we do</a></li>
              <li><a href="about.html#framework" class="subtitle-link">Operational framework</a></li>
              <li><a href="about.html#team" class="subtitle-link">Our team & governance</a></li>
            </ul>
          </div>

          <!-- mobile submenu (kept for hamburger) -->
          <ul class="sub" aria-label="About submenu">
            <li><a href="about.html#who">Who we are</a></li>
            <li><a href="about.html#what-we-do">What we do</a></li>
            <li><a href="about.html#framework">Operational framework</a></li>
            <li><a href="about.html#team">Our team & governance</a></li>
          </ul>
        </li>

        <li class="nav-item has-sub" id="nav-ourwork">
          <a href="our-work.html" aria-haspopup="true" aria-expanded="false">Our Work â–¾</a>

          <div class="nav-subtitle" role="dialog" aria-hidden="true" aria-labelledby="ourwork-subtitle">
            <ul class="subtitle-list">
              <li><a href="programs.html" class="subtitle-link">Core programs</a></li>
              <li><a href="our-work.html#consortia" class="subtitle-link">Clinical consortia</a></li>
              <li><a href="our-work.html#regions" class="subtitle-link">Regional activity</a></li>
              <li><a href="our-work.html#impact" class="subtitle-link">Impact & results</a></li>
            </ul>
          </div>

          <ul class="sub" aria-label="Our Work submenu">
            <li><a href="programs.html">Programs</a></li>
            <li><a href="our-work.html#consortia">Consortia</a></li>
            <li><a href="our-work.html#regions">Regions</a></li>
          </ul>
        </li>

        <li class="nav-item"><a href="programs.html">Programs</a></li>
        <li class="nav-item"><a href="membership.html">Membership</a></li>
        <li class="nav-item"><a href="resources.html">Resources</a></li>
        <li class="nav-item"><a href="events.html">Events & Blogs</a></li>
        <li class="nav-item"><a href="opportunities.html">Opportunities</a></li>
        <li class="nav-item"><a href="awareness.html">Awareness</a></li>
        <li class="nav-item"><a href="contact.html">Contact</a></li>

        <!-- SETTINGS (single desktop link + mobile-only toggle + mobile submenu)
             - Desktop: user sees the "Settings" anchor and the .nav-subtitle popover on hover/focus
             - Mobile: the .mobile-only toggle (plus symbol) is shown and toggles the submenu;
               the mobile-only element is hidden on desktop so you do not get two visible "Settings" -->
        <li class="nav-item has-sub" id="nav-settings">
          <!-- Desktop link (visible on all widths) -->
          <!-- <a href="settings.html" aria-haspopup="true" aria-expanded="false" id="settingsDesktopLink">Settings â–¾</a> -->
          <a href="settings.html" aria-haspopup="true" aria-expanded="false">Settings â–¾</a>


          <!-- desktop popover -->
          <div class="nav-subtitle" role="dialog" aria-hidden="true" aria-labelledby="settings-subtitle">
            <ul class="subtitle-list">
              <li><a href="settings.html#account">Account settings</a></li>
              <li><a href="settings.html#privacy">Privacy & security</a></li>
              <li><a href="settings.html#appearance">Appearance</a></li>
            </ul>
          </div>

          <!-- Mobile-only toggle: hidden on desktop by .mobile-only rule above
          <a href="#" class="mobile-toggle mobile-only" data-target="settingsSub" aria-controls="settingsSub" aria-expanded="false" id="settingsMobileToggle" style="justify-content:space-between;width:100%;padding:6px 0;">
            <span>Settings</span>
            <span class="toggle-symbol" aria-hidden="true">+</span>
          </a> -->

          <!-- mobile submenu -->
          <ul class="sub mobile-sub" id="settingsSub" aria-hidden="true">
            <li><a href="settings.html#account">Account settings</a></li>
            <li><a href="settings.html#privacy">Privacy & security</a></li>
            <li><a href="settings.html#appearance">Appearance</a></li>
          </ul>
        </li>
        <!-- /SETTINGS -->

      </ul>
    </nav>

    <div class="header-cta">
      <a class="btn donate" id="donateBtn" href="donate.html" title="Donate">Donate</a>
      <button class="hamb" id="hambBtn" aria-expanded="false" aria-controls="mobileMenu" aria-label="Open menu">â˜°</button>
    </div>
  </div>

  <div class="mobile-menu" id="mobileMenu" aria-hidden="true"></div>
</header>

  <!-- MAIN -->
  <main id="main" role="main">
    <!-- HERO -->
    <section id="home" class="hero" aria-label="Hero">
      <!-- slides container -->
      <div class="hero-slides" id="heroSlides" aria-hidden="false"></div>

      <div class="hero-inner container">
        <!-- Left: big text area (title + dynamic description) -->
        <div class="hero-intro" aria-labelledby="heroTitle">
          <!-- <span class="tag">Community â€¢ Eye Health â€¢ Somalia</span> -->
          <h2 id="heroTitle">Protecting & restoring sight across Somalia</h2>

          <!-- dynamic description (updated per slide by script.js) -->
          <div id="heroDescription" class="lead">
            Somali Eye Health Alliance supports local clinics, trains eye-care teams, and runs community screening and surgical outreach so Somalis can keep their sight close to home.
          </div>

          <div class="hero-actions">
            <a class="btn btn-primary" href="programs.html">Our Programs</a>
            <a class="btn btn-outline" href="donate.html">Donate</a>
          </div>
        </div>

        <!-- Right: controls (prev/next overlayed), thumbnails and caption -->
        <div class="hero-side">

          <div class="hero-gallery" id="heroGallery" aria-hidden="false" role="list">
            <!-- thumbnails populated by script.js -->
          </div>

          <!-- per-slide caption box (populated by script.js) -->
          <div id="heroCaptionBox" class="hero-caption card" aria-live="polite">
            <h4 id="heroCaptionTitle">Protecting & restoring sight across Somalia</h4>
            <p id="heroCaptionText"> Somali Eye Health Alliance supports local clinics, trains eye-care teams, and runs community outreach that brings services closer to people.</p>
            <p id="heroCaptionExtra" class="muted">Read more about this program and how it benefits communities in every region.</p>
            <p style="margin-top:8px"><a href="our-work.html">Learn more â†’</a></p>
          </div>
        </div>
      </div>
    </section>

    <!-- MISSION & GOALS (separate section; NOT overlaid on hero) -->
<section id="mission" class="section bg-light">
  <div class="container two-col">
    <div class="card">
      <h3 class="section-heading">
        <img class="section-icon" src="images/mission.jpg" alt="Mission icon" />
        <span>Mission</span>
      </h3>
      <p class="muted">Strengthen local eye-care systems across Somalia through capacity building, coordinated outreach, and knowledge sharing so people receive safe, accessible eye services close to home.</p>
    </div>

    <div class="card">
      <h3 class="section-heading">
        <img class="section-icon" src="images/goals.png" alt="Goals icon" />
        <span>Goals</span>
      </h3>
      <ul class="small-list muted">
        <li>Increase screening and treatment coverage across regions</li>
        <li>Grow a sustainable local eye health workforce</li>
        <li>Support clinics with practical financing and operational tools</li>
      </ul>
    </div>
  </div>
</section>

 <!-- IMPACT -->
<section id="impact" class="section" aria-labelledby="impactHeading">
  <div class="container">
    <h3 id="impactHeading" class="section-heading">
      <img class="section-icon" src="images/impact.png" alt="Impact icon" />
      <span>Our Impact (Selected)</span>
    </h3>
    <p class="muted"> Somali Eye Health Alliance measures impact by people reached, surgeries supported and local capacity built.</p>

    <div class="stats-row" style="margin-top:12px;">
      <div class="stat">
        <div class="stat-number teal"><span class="count" data-target="12400" data-suffix="+">0</span><span class="suffix">+</span></div>
        <div class="muted">people screened (since 2022)</div>
      </div>
    
      <div class="stat">
        <div class="stat-number blue"><span class="count" data-target="4300" data-suffix="+">0</span><span class="suffix">+</span></div>
        <div class="muted">sight-restoring surgeries supported</div>
      </div>
    
      <div class="stat">
        <div class="stat-number orange"><span class="count" data-target="86" data-suffix="">0</span><span class="suffix"></span></div>
        <div class="muted">local clinics & partners</div>
      </div>
    </div>
    

    <div class="card" style="margin-top:18px;">
      <h4 class="section-heading">
        <img class="section-icon" src="images/recent.png" alt="Recent highlight icon" />
        <span>Recent highlight</span>
      </h4>

      <div class="recent-highlight">
        <div>
          <p class="muted">In 2025  Somali Eye Health Alliance supported a 4-week outreach in Beledweyne and Afgooye that screened 2,300 people and fitted 780 spectacles. Local teams were mentored in triage and low-vision follow-up.</p>
        </div>
      </div>
    </div>
  </div>
</section>
 <!-- PROGRAMS PREVIEW -->
<section id="programs-preview" class="section bg-light" aria-labelledby="programsHeading">
  <div class="container">
    <h3 id="programsHeading" class="section-heading">
      <img class="section-icon" src="images/core.png" alt="Core programs icon" />
      <span>Core programs</span>
    </h3>
    <p class="muted"> Somali Eye Health Alliance coordinates programs designed for Somalia's context: low-resource clinics, mobile outreach, research, and workforce development.</p>

    <div class="grid grid-3" id="programGrid" aria-live="polite" style="margin-top:16px;">
      <!-- sample program cards: script.js will still populate these if used -->
      <div class="program-card card">
        <div class="card-heading">
          <img class="icon" src="images/core.png" alt="Program icon">
          <div><strong>Screening & Spectacles</strong><div class="muted">Community & school screening</div></div>
        </div>
      </div>

      <div class="program-card card">
        <div class="card-heading">
          <img class="icon" src="images/core.png" alt="Program icon">
          <div><strong>Surgical Camps</strong><div class="muted">Cataract & mentorship</div></div>
        </div>
      </div>

      <div class="program-card card">
        <div class="card-heading">
          <img class="icon" src="images/core.png" alt="Program icon">
          <div><strong>Workforce Training</strong><div class="muted">CPD & local trainers</div></div>
        </div>
      </div>
    </div>

    <p style="margin-top:14px"><a href="programs.html">See all programs â†’</a></p>
  </div>
</section>

  <!-- EXPLORE: summary links to all main pages -->
<section id="explore" class="section">
  <div class="container">
    <h3 class="section-heading">
      <img class="section-icon" src="images/explore.png" alt="Explore icon" />
      <span>Explore  Somali Eye Health Alliance</span>
    </h3>
    <p class="muted">Quick summaries and links to key pages across the site.</p>
        <div class="grid grid-3" style="margin-top:14px;">
          <div class="card">
            <h4>About Us</h4>
            <p class="muted">Who we are, our principles and the team behind  Somali Eye Health Alliance. Learn how we coordinate clinics and partners across Somalia.</p>
            <p><a href="about.html">About â†’</a></p>
          </div>

          <div class="card">
            <h4>Our Work</h4>
            <p class="muted">Programs, consortia and regional approaches we use to deliver sustainable eye health services.</p>
            <p><a href="our-work.html">Our Work â†’</a></p>
          </div>

          <div class="card">
            <h4>Membership</h4>
            <p class="muted">Join our network as a clinic, volunteer or organisational partner to receive support and opportunities.</p>
            <p><a href="membership.html">Membership â†’</a></p>
          </div>

          <div class="card">
            <h4>Resources</h4>
            <p class="muted">Guides, toolkits and photos from outreach and campaigns â€” open resource library for partners.</p>
            <p><a href="resources.html">Resources â†’</a></p>
          </div>

          <div class="card">
            <h4>Events & Blogs</h4>
            <p class="muted">Workshops, launches and field reports â€” view posts, register for trainings, and join discussions.</p>
            <p><a href="events.html">Events & Blogs â†’</a></p>
          </div>

          <div class="card">
            <h4>Opportunities</h4>
            <p class="muted">Volunteer placements, short contracts and research roles. See live openings and apply online.</p>
            <p><a href="opportunities.html">Opportunities â†’</a></p>
          </div>

          <div class="card">
            <h4>Awareness</h4>
            <p class="muted">Campaign toolkits, posters and community messaging to promote eye health and prevention.</p>
            <p><a href="awareness.html">Awareness â†’</a></p>
          </div>

          <div class="card">
            <h4>Contact</h4>
            <p class="muted">Questions or partnership enquiries? Get in touch with our team.</p>
            <p><a href="contact.html">Contact â†’</a></p>
          </div>
        </div>
      </div>
    </section>

<!-- MEDIA PREVIEW -->
<section id="resources-preview" class="section bg-light" aria-labelledby="resourcesHeading">
  <div class="container">
    <h3 id="resourcesHeading" class="section-heading">
      <img class="section-icon" src="images/resources.png" alt="Resources icon" />
      <span>Resources & media</span>
    </h3>
    <p class="muted">Photos, guides and reports from field activities â€” click thumbnails to enlarge and download toolkits.</p>
        <div class="gallery-grid" id="resourceGallery" aria-live="polite" style="margin-top:12px;"></div>
        <p style="margin-top:14px"><a href="resources.html">Open resource library â†’</a></p>
      </div>
    </section>

   <!-- EVENTS PREVIEW -->
<section id="events-preview" class="section" aria-labelledby="eventsHeading">
  <div class="container">
    <h3 id="eventsHeading" class="section-heading">
      <!-- use events.png with fallback to evens.png if needed -->
      <img class="section-icon" src="images/events.png" alt="Events icon" onerror="this.onerror=null;this.src='images/evens.png';" />
      <span>Events & announcements</span>
    </h3>
        <p class="muted">Workshops, surveys and program launches â€” stay informed and register for trainings.</p>
        <div class="grid grid-3" id="eventsGrid" style="margin-top:12px;"></div>
        <p style="margin-top:14px"><a href="events.html">See events & blog posts â†’</a></p>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer" role="contentinfo">
    <div class="container footer-inner">
      <div class="footer-col">
        <img src="images/logo.png" alt="SEHA logo" class="footer-logo">
        <p class="muted">Â© 2026 Somali Eye Health Alliance â€” All Rights Reserved <a href="/public/admin/developers-contact.html">Developers</a></p>
      </div>

      <div class="footer-col">
        <h4>Quick links</h4>
        <ul class="small-list footer-links">
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About Us</a></li>
          <li><a href="programs.html">Programs</a></li>
          <li><a href="resources.html">Resources</a></li>
          <li><a href="membership.html">Membership</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4>Contact</h4>
        <address class="muted">
          Mogadishu, Somalia<br>
          info@Somalieyehealthalliance.org <br>
          +252 61 7000264
                </address>
      </div>
    </div>
  </footer>

  <!-- Back to top button (floating) -->
  <button class="seha-back-to-top" id="sehaBackToTop" aria-label="Back to top" title="Back to top">
    <!-- up arrow SVG uses currentColor -->
    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" fill="currentColor">
      <path d="M12 4l-8 8h5v8h6v-8h5z"/>
    </svg>
  </button>

    
<!-- help-widget.html -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
/* compact modern widget styles (mobile-first) */
/* ... same styles as before (omitted for brevity) ... */
#sehaHelpRoot { font-family: Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; position: fixed; right: 50px; bottom: 16px; z-index: 9999; }
/* ADDED: give the floating FAB a small right-margin to space it from the edge */
.seha-fab { width:46px;height:46px;border-radius:50%;background:#0f766e;color:#fff;border:0;box-shadow:0 8px 24px rgba(15,118,110,0.2); cursor:pointer; display:flex;align-items:center;justify-content:center;font-size:20px; margin-right:29px; margin-bottom: -15px; }

/* ADDED: ensure buttons inside the panel get a small right margin */
.seha-panel .btn, #sehaHelpPanel .btn { margin-right: 41px; }

.seha-panel { width:92vw; max-width:420px; height:72vh; max-height:760px; background:#fff;border-radius:12px;box-shadow:0 20px 40px rgba(2,6,23,0.12); display:flex;flex-direction:column; overflow:hidden; }
.seha-header { padding:12px 14px; border-bottom:1px solid #f0f3f5; display:flex; align-items:center; gap:10px; }
.seha-title { font-weight:700; font-size:16px; margin:0; }
.seha-sub { color:#6b7280; font-size:13px }
.seha-body { padding:12px; flex:1; overflow:auto; display:flex; flex-direction:column; gap:10px; background:linear-gradient(#fff,#fbfdfe); }
.convo { display:flex; flex-direction:column; gap:8px; }
.msg { max-width:78%; padding:10px 12px; border-radius:10px; background:#f3f9f8; font-size:14px; color:#033; box-shadow:0 2px 6px rgba(2,6,23,0.04) }
.msg.user { background:#0f766e; color:#fff; align-self:flex-end; border-radius:10px 10px 6px 10px; }
.small { font-size:13px; color:#6b7280 }
.controls { display:flex; gap:8px; flex-wrap:wrap; }
.btn { padding:8px 12px; border-radius:8px; border:0; background:#e6f6f4; color:#0f766e; cursor:pointer }
.btn.primary { background:#0f766e; color:#fff }
.footer { padding:10px; border-top:1px solid #f0f3f5; display:flex; gap:8px; align-items:center }
.input { flex:1; padding:8px 10px; border-radius:8px; border:1px solid #eef2f2 }
.hidden { display:none }
@media(min-width:900px){ #sehaHelpRoot { right:40px; bottom:40px; } .seha-panel { width:420px; height:68vh; } }
</style>





<div id="sehaHelpRoot" aria-live="polite">
  <button id="sehaHelpFab" class="seha-fab " aria-label="Open support chat">ðŸ’¬</button>
  <div id="sehaHelpPanel" class="seha-panel hidden" role="dialog" aria-modal="false" aria-label="Support chat">
    <div class="seha-header">
      <div style="display:flex;align-items:center;gap:10px">
        <div style="width:40px;height:40px;border-radius:8px;background:#e6f6f4;color:#0f766e;display:flex;align-items:center;justify-content:center;font-weight:700">S</div>
        <div>
          <div class="seha-title"> Somali Eye Health Alliance Support</div>
          <div class="seha-sub" id="sehaHelpSub">Ask for help â€” anonymous OK</div>
        </div>
      </div>
      <div style="margin-left:auto">
        <button id="sehaCloseBtn" style="background:transparent;border:0;color:#6b7280;cursor:pointer">âœ•</button>
      </div>
    </div>

    <div class="seha-body" id="sehaBody"></div>

    <div class="footer" id="sehaFooter">
      <input id="sehaInput" class="input" placeholder="Type a message..." />
      <button id="sehaSend" class="btn primary">Send</button>
    </div>
  </div>
</div>


<script>
  /*
    Help FAB click routing:
    - Admin / Superadmin => open admin inbox page
    - Otherwise => open the help widget panel (so homepage remains visible)
  */
  (function(){
    function safeGetUser() {
      try { if (typeof window.getUser === 'function') return window.getUser(); } catch(e){}
      try { const u = localStorage.getItem('seha_user'); return u ? JSON.parse(u) : null; } catch(e){ return null; }
    }
    function safeGetToken() {
      try { if (typeof window.getToken === 'function') return window.getToken(); } catch(e){}
      return localStorage.getItem('seha_token') || null;
    }
  
    // find FAB and widget panel if present
    const fab = document.getElementById('sehaHelpFab');
    const panel = document.getElementById('sehaHelpPanel');
    const closeBtn = document.getElementById('sehaCloseBtn');
  
    function openWidgetPanel() {
      if (!panel || !fab) return;
      panel.classList.remove('hidden');
      fab.style.display = 'none';
      // focus input for better UX
      const input = panel.querySelector('#sehaInput');
      if (input) setTimeout(()=> input.focus(), 120);
    }
  
    function closeWidgetPanel() {
      if (!panel || !fab) return;
      panel.classList.add('hidden');
      fab.style.display = 'flex';
    }
  
    if (!fab) return; // nothing to wire
  
    fab.addEventListener('click', (e) => {
      // check role - prefer getUser() if available, fallback to token/json in storage
      const token = safeGetToken();
      const user = safeGetUser();
      const role = user && user.role ? String(user.role).toLowerCase() : null;
  
      if (token && (role === 'admin' || role === 'superadmin')) {
        // admin: open admin inbox in same tab
        // If you prefer new tab, change to window.open('/admin/help-inbox.html', '_blank')
        window.location.href = 'admin/help-inbox.html';
        return;
      }
  
      // otherwise, show the normal user widget
      if (panel) {
        openWidgetPanel();
      } else {
        // If widget not present on this page, navigate to a page that hosts it
        window.location.href = 'help-widget.html';
      }
    });
  
    if (closeBtn) closeBtn.addEventListener('click', closeWidgetPanel);
  
    // Optional: allow keyboard ESC to close widget
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape' && panel && !panel.classList.contains('hidden')) closeWidgetPanel();
    });
  })();
  
  (function () {
  const API_BASE = (location.hostname === 'localhost' || location.hostname === '127.0.0.1') ? 'http://localhost:4000' : '';

  // DOM
  const fab = document.getElementById('sehaHelpFab');
  const panel = document.getElementById('sehaHelpPanel');
  const closeBtn = document.getElementById('sehaCloseBtn');
  const body = document.getElementById('sehaBody');
  const sub = document.getElementById('sehaHelpSub');
  const input = document.getElementById('sehaInput');
  const send = document.getElementById('sehaSend');

  // local keys
  const localKeyAnon = 'seha_help_anon';
  const localConvKey = 'seha_help_conv';
  const sendQueueKey = 'seha_help_queue';

  // state
  let currentConv = null;
  let socket = null;
  let pollTimer = null;
  let loadExistingDebounce = 0;

  // helpers
  function safeGetUser() { try { if (typeof window.getUser === 'function') return window.getUser(); } catch(e){} try { const u = localStorage.getItem('seha_user'); return u ? JSON.parse(u) : null } catch(e) { return null } }
  function safeGetToken() { try { if (typeof window.getToken === 'function') return window.getToken(); } catch(e){} return localStorage.getItem('seha_token') || null; }
  function ensureAnon() {
    try {
      let anon = JSON.parse(localStorage.getItem(localKeyAnon) || 'null');
      if (!anon) { anon = { anonId: 'anon-' + Math.random().toString(36).slice(2,10), name: null }; localStorage.setItem(localKeyAnon, JSON.stringify(anon)); }
      return anon;
    } catch (e) { const anon = { anonId: 'anon-' + Math.random().toString(36).slice(2,10), name: null }; localStorage.setItem(localKeyAnon, JSON.stringify(anon)); return anon; }
  }
  function anonLabel(anonId) { if (!anonId) return 'Anonymous'; return 'Anonymous-' + String(anonId).slice(-6); }
  function escapeHtml(s) { if (!s) return ''; return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  /* Robust apiFetch with retry/backoff for 429 + transient errors */
  async function apiFetch(url, opts = {}, { retries = 2, backoff = 400 } = {}) {
    opts.headers = opts.headers || {};
    const token = safeGetToken();
    if (token) opts.headers['Authorization'] = 'Bearer ' + token;
    if (opts.body && !opts.headers['Content-Type']) opts.headers['Content-Type'] = 'application/json';
    opts.method = opts.method || (opts.body ? 'POST' : 'GET');

    let attempt = 0;
    while (attempt <= retries) {
      try {
        const res = await fetch((API_BASE || '') + url, opts);
        const json = await res.json().catch(()=>null);
        if (res.status === 429) { const wait = backoff * Math.pow(2, attempt); await new Promise(r => setTimeout(r, wait)); attempt++; continue; }
        return { ok: res.ok, status: res.status, data: json };
      } catch (err) {
        if (attempt < retries) { const wait = backoff * Math.pow(2, attempt); await new Promise(r => setTimeout(r, wait)); attempt++; continue; }
        return { ok:false, status:0, error: err };
      }
    }
    return { ok:false, status:429, error: 'Too many requests' };
  }

  /* queue helpers */
  function loadQueue() { try { return JSON.parse(localStorage.getItem(sendQueueKey) || '[]'); } catch(e) { return []; } }
  function saveQueue(q) { localStorage.setItem(sendQueueKey, JSON.stringify(q || [])); }
  function enqueueMessage(payload) { const q = loadQueue(); q.push(payload); saveQueue(q); }
  async function flushQueue() {
    const q = loadQueue();
    if (!q.length) return;
    const remaining = [];
    for (const item of q) {
      try {
        if (item.type === 'append' && item.convId) {
          const r = await apiFetch('/api/help/conversations/' + encodeURIComponent(item.convId) + '/messages', { method: 'POST', body: JSON.stringify({ text: item.text, topic: item.topic }) }, { retries: 3 });
          if (!r.ok) remaining.push(item); else {
            if (currentConv && String(currentConv._id) === String(item.convId)) { currentConv = r.data.conversation || currentConv; localStorage.setItem(localConvKey, JSON.stringify(currentConv)); renderMessages(currentConv.messages || []); }
          }
        } else if (item.type === 'create') {
          const r = await apiFetch('/api/help/conversations', { method: 'POST', body: JSON.stringify(item.payload) }, { retries: 3 });
          if (!r.ok) remaining.push(item); else { currentConv = r.data.conversation; localStorage.setItem(localConvKey, JSON.stringify(currentConv)); renderMessages(currentConv.messages || []); }
        }
      } catch (e) { remaining.push(item); }
    }
    saveQueue(remaining);
  }

  /* RENDERING */
  function renderMessages(messages) {
    body.innerHTML = '';
    const convDiv = document.createElement('div');
    convDiv.className = 'convo';
    if (!messages || messages.length === 0) {
      convDiv.innerHTML = '<div class="muted">No messages yet</div>';
    } else {
      messages.forEach(m => {
        const d = document.createElement('div');
        d.className = 'msg' + (m.sender === 'user' ? ' user' : '');
        const txt = document.createElement('div');
        txt.textContent = m.text || '';
        d.appendChild(txt);
        const meta = document.createElement('div');
        meta.className = 'muted';
        const who = m.senderName ? m.senderName : (m.sender === 'user' ? (currentConv && currentConv.name ? currentConv.name : anonLabel(currentConv && currentConv.anonId)) : 'Support');
        const t = m.createdAt ? new Date(m.createdAt).toLocaleString() : '';
        const topic = (m.meta && m.meta.topic) ? ` â€¢ ${m.meta.topic}` : '';
        meta.textContent = `${who}${topic} â€¢ ${t}`;
        d.appendChild(meta);
        convDiv.appendChild(d);
      });
    }
    body.appendChild(convDiv);
    body.scrollTop = body.scrollHeight;
  }

  function appendLocalMessage(msg) {
    currentConv.messages = currentConv.messages || [];
    currentConv.messages.push(msg);
    localStorage.setItem(localConvKey, JSON.stringify(currentConv));
    renderMessages(currentConv.messages || []);
  }

  /* FLOWS: welcome -> topic -> followup -> create conv */
  function showWelcomeFlow() {
    body.innerHTML = '';
    const el = document.createElement('div');
    el.innerHTML = `
      <div style="font-weight:700">How can we help?</div>
      <div class="muted" style="margin-bottom:8px">Choose a topic so we can route your message:</div>
      <div class="controls" id="topicBtns">
        <button class="btn" data-topic="Donation">Donation</button>
        <button class="btn" data-topic="Membership">Membership</button>
        <button class="btn" data-topic="Opportunities">Opportunities</button>
        <button class="btn" data-topic="Other">Other</button>
      </div>
      <div style="margin-top:8px" id="namePrompt"></div>
    `;
    body.appendChild(el);

    const anon = ensureAnon();
    const user = safeGetUser();
    const namePrompt = document.getElementById('namePrompt');

    if (!user) {
      namePrompt.innerHTML = `<div class="muted">What should we call you? (optional)</div>
        <div style="display:flex;gap:8px;margin-top:6px">
          <input id="visitorName" class="input" placeholder="Your name or leave anonymous" value="${anon.name ? escapeHtml(anon.name) : ''}" />
          <button id="saveVisitorName" class="btn">Save</button>
        </div>
        <div id="visitorSavedMsg" class="muted" style="margin-top:6px; display:${anon.name ? 'block' : 'none'}">Saved as <strong id="visitorSaved">${anon.name ? escapeHtml(anon.name) : ''}</strong></div>
      `;
      const inputEl = document.getElementById('visitorName');
      const saveBtn = document.getElementById('saveVisitorName');
      const savedMsg = document.getElementById('visitorSavedMsg');
      const savedNameSpan = document.getElementById('visitorSaved');

      saveBtn.addEventListener('click', () => {
        const val = (inputEl.value || '').trim();
        if (val) { anon.name = val; localStorage.setItem(localKeyAnon, JSON.stringify(anon)); savedNameSpan.textContent = val; savedMsg.style.display = 'block'; sub.textContent = 'Visitor: ' + val; }
        else { anon.name = null; localStorage.setItem(localKeyAnon, JSON.stringify(anon)); savedMsg.style.display = 'none'; sub.textContent = 'Ask for help â€” anonymous OK'; }
      });

      inputEl.addEventListener('keydown', (ev) => { if (ev.key === 'Enter') { ev.preventDefault(); saveBtn.click(); } });
    } else {
      sub.textContent = 'Logged in as ' + (user.fullName || user.name || 'You');
    }

    document.querySelectorAll('#topicBtns .btn').forEach(b => { b.addEventListener('click', () => askFollowUp(b.dataset.topic)); });
  }

  function askFollowUp(topic) {
    body.innerHTML = '';
    const wrapper = document.createElement('div');
    wrapper.innerHTML = `
      <div style="font-weight:700">${escapeHtml(topic)}</div>
      <div class="muted" style="margin-bottom:8px">Please tell us more about your ${escapeHtml(topic.toLowerCase())} question (short summary)</div>
      <textarea id="followText" rows="4" style="width:100%;padding:8px;border-radius:8px;border:1px solid #eef2f2"></textarea>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
        <button id="backTopic" class="btn">Back</button>
        <button id="startConv" class="btn primary">Start chat</button>
      </div>
    `;
    body.appendChild(wrapper);
    document.getElementById('backTopic').addEventListener('click', showWelcomeFlow);
    document.getElementById('startConv').addEventListener('click', async () => {
      const details = (document.getElementById('followText').value || '').trim();
      await startConversation(topic, details);
    });
  }

  async function startConversation(topic, details) {
    const anon = ensureAnon();
    const user = safeGetUser();
    const payload = { anonId: anon.anonId, initialMessage: details || ('Start: ' + topic), topic, details, name: anon.name || null };

    // optimistic UI
    currentConv = { localId:'local-'+Date.now(), anonId: anon.anonId, name: anon.name || null, messages: [{ sender:'user', text: payload.initialMessage, createdAt: new Date().toISOString(), senderName: payload.name || null, meta: { topic } }], meta: { topic, details } };
    localStorage.setItem(localConvKey, JSON.stringify(currentConv));
    renderMessages(currentConv.messages);

    // try create on server
    const r = await apiFetch('/api/help/conversations', { method:'POST', body: JSON.stringify(payload) }, { retries: 3 });
    if (!r.ok) {
      // enqueue create for later
      enqueueMessage({ type:'create', payload });
      startPolling();
      return;
    }
    currentConv = r.data.conversation;
    localStorage.setItem(localConvKey, JSON.stringify(currentConv));
    renderMessages(currentConv.messages || []);
    if (socket && currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
    flushQueue();
    startPolling();
  }

  /* Send message from input */
  async function sendMessageFromInput() {
    const txt = (input.value || '').trim();
    if (!txt) return;
    input.value = '';
    const anon = ensureAnon();
    const now = new Date().toISOString();
    const msg = { _id: 'm-' + Date.now(), sender:'user', text: txt, createdAt: now, status: 'pending', senderName: (currentConv && currentConv.name) ? currentConv.name : (anon.name || null), meta: (currentConv && currentConv.meta) ? currentConv.meta : null };
    if (!currentConv) currentConv = { localId:'local-'+Date.now(), anonId: anon.anonId, messages: [] };
    appendLocalMessage(msg);

    // if server conv exists
    if (currentConv._id) {
      const r = await apiFetch('/api/help/conversations/' + encodeURIComponent(currentConv._id) + '/messages', { method:'POST', body: JSON.stringify({ text: txt }) }, { retries: 2 });
      if (r.ok && r.data && r.data.conversation) {
        currentConv = r.data.conversation;
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        renderMessages(currentConv.messages || []);
        flushQueue();
        return;
      } else {
        enqueueMessage({ type:'append', convId: currentConv._id, text: txt, topic: (currentConv.meta && currentConv.meta.topic) ? currentConv.meta.topic : undefined });
        const last = currentConv.messages[currentConv.messages.length -1];
        if (last) last.status = 'failed';
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        renderMessages(currentConv.messages || []);
        startPolling();
        return;
      }
    }

    // else create conv with initial message
    const payload = { anonId: anon.anonId, initialMessage: txt, topic: (currentConv && currentConv.meta) ? currentConv.meta.topic : undefined, details: (currentConv && currentConv.meta) ? currentConv.meta.details : undefined, name: anon.name || undefined };
    const r2 = await apiFetch('/api/help/conversations', { method:'POST', body: JSON.stringify(payload) }, { retries: 3 });
    if (r2.ok && r2.data && r2.data.conversation) {
      currentConv = r2.data.conversation;
      localStorage.setItem(localConvKey, JSON.stringify(currentConv));
      renderMessages(currentConv.messages || []);
      if (socket && currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
      flushQueue();
      return;
    } else {
      enqueueMessage({ type:'create', payload });
      startPolling();
      return;
    }
  }

  /* POLLING + SOCKET fallback */
  function startPolling() { if (pollTimer) return; pollTimer = setInterval(async () => { await flushQueue(); const nowt = Date.now(); if (nowt - loadExistingDebounce > 2500) { loadExistingDebounce = nowt; await loadExisting(false).catch(()=>{}); } }, 3500); }
  function stopPolling() { if (pollTimer) { clearInterval(pollTimer); pollTimer = null; } }

  async function loadExisting(focus = true) {
    const user = safeGetUser();
    const anon = ensureAnon();
    const token = safeGetToken();

    if (token) {
      const r = await apiFetch('/api/help/conversations/me');
      if (r.ok && r.data && r.data.conversation) {
        currentConv = r.data.conversation;
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        sub.textContent = 'Logged in as ' + (user && (user.fullName || user.name) ? (user.fullName || user.name) : 'You');
        renderMessages(currentConv.messages || []);
        if (socket && currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
        return;
      } else if (r.status === 404) { /* no conv */ } else if (r.status === 429) { return; }
    }

    const raw = localStorage.getItem(localConvKey);
    if (raw) {
      try { currentConv = JSON.parse(raw); renderMessages(currentConv.messages || []); return; } catch(e){ currentConv = null; }
    }

    const r2 = await apiFetch('/api/help/conversations/anon/' + encodeURIComponent(anon.anonId));
    if (r2.ok && r2.data && r2.data.conversation) {
      currentConv = r2.data.conversation;
      localStorage.setItem(localConvKey, JSON.stringify(currentConv));
      renderMessages(currentConv.messages || []);
      if (socket && currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
      return;
    }

    showWelcomeFlow();
    startPolling();
  }

  function loadSocketIoClient(cb) {
    if (window.io) return cb(null);
    const tryUrls = [];
    if (API_BASE) tryUrls.push(API_BASE + '/socket.io/socket.io.js');
    tryUrls.push('https://cdn.socket.io/4.6.1/socket.io.min.js');
    let i = 0;
    function next() {
      if (i >= tryUrls.length) return cb(new Error('socket.io client failed to load'));
      const src = tryUrls[i++];
      const s = document.createElement('script'); s.src = src; s.async = true;
      s.onload = () => { if (window.io) return cb(null); else next(); };
      s.onerror = () => { console.warn('socket.io client failed load:', src); next(); };
      document.head.appendChild(s);
    }
    next();
  }

  function initSocket() {
    if (!window.io) return;
    const token = safeGetToken();
    socket = io(API_BASE || '/', { auth: token ? { token } : undefined, transports: ['websocket','polling'] });

    socket.on('connect', () => {
      if (currentConv && currentConv._id) socket.emit('identify', { convId: currentConv._id });
      stopPolling();
    });

    socket.on('help.message', (data) => {
      if (!data || !data.conversationId) return;
      if (currentConv && String(currentConv._id) === String(data.conversationId)) {
        currentConv.messages = currentConv.messages || [];
        if (data.message) currentConv.messages.push(data.message);
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        renderMessages(currentConv.messages || []);
      }
    });

    socket.on('help.updated', (data) => {
      if (data && data.conversation && currentConv && String(currentConv._id) === String(data.conversation._id)) {
        currentConv = data.conversation;
        localStorage.setItem(localConvKey, JSON.stringify(currentConv));
        renderMessages(currentConv.messages || []);
      }
    });

    socket.on('connect_error', (err) => { console.warn('socket connect_error', err && err.message ? err.message : err); startPolling(); });
    socket.on('disconnect', () => startPolling());
  }

  /* UI wiring */
  if (fab) {
    fab.addEventListener('click', async () => {
      panel.classList.remove('hidden');
      fab.style.display = 'none';
      loadSocketIoClient((err) => { if (!err) initSocket(); else startPolling(); });
      await loadExisting();
    });
  }

  if (closeBtn) closeBtn.addEventListener('click', () => {
    panel.classList.add('hidden');
    fab.style.display = 'flex';
    stopPolling();
  });

  if (send) send.addEventListener('click', sendMessageFromInput);
  if (input) input.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessageFromInput(); } });

  (function preInit() {
    const user = safeGetUser();
    if (user && (user.fullName || user.name)) sub.textContent = 'Signed in as ' + (user.fullName || user.name);
    const raw = localStorage.getItem(localConvKey);
    if (raw) {
      try { currentConv = JSON.parse(raw); renderMessages(currentConv.messages || []); } catch(e){ /* ignore */ }
    } else { showWelcomeFlow(); }
    setTimeout(flushQueue, 600);
  })();

  // expose helpers (debug)
  window.__seha_help = { ensureAnon, getCurrentConv: () => currentConv, startPolling, stopPolling, flushQueue };

})();

(function() {
  // formatting helper with locale-aware thousands separator
  const fmt = (n) => new Intl.NumberFormat().format(Math.round(n));

  // count-up animation function
  function animateCount(el, start, end, duration = 1400, suffix = '') {
    const startTime = performance.now();
    function tick(now) {
      const elapsed = now - startTime;
      const progress = Math.min(elapsed / duration, 1);
      // easeOutCubic
      const eased = 1 - Math.pow(1 - progress, 3);
      const value = start + (end - start) * eased;
      el.textContent = fmt(value);
      if (progress < 1) {
        requestAnimationFrame(tick);
      } else {
        // ensure final exact value
        el.textContent = fmt(end);
        if (suffix) {
          // suffix displayed in separate .suffix element already
        }
      }
    }
    requestAnimationFrame(tick);
  }

  // Find all counters
  const counters = Array.from(document.querySelectorAll('.stat .count'));
  if (!counters.length) return;

  // IntersectionObserver to trigger when stats visible
  const io = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) return;
      const span = entry.target;
      const target = parseInt(span.dataset.target || '0', 10) || 0;
      const suffix = span.dataset.suffix || '';
      // guard â€” prevent double animation
      const parentStat = span.closest('.stat');
      if (parentStat && parentStat.dataset.animated === 'true') {
        obs.unobserve(span);
        return;
      }
      // animate
      animateCount(span, 0, target, 1500, suffix);
      if (parentStat) parentStat.dataset.animated = 'true';
      // unobserve this counter
      obs.unobserve(span);
    });
  }, { threshold: 0.4 });

  counters.forEach(c => io.observe(c));
})();


  </script>
  
  <script src="script.js"></script>
</body>
</html>
